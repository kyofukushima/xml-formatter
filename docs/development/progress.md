# 開発進捗管理

## 概要

本ドキュメントは、XML変換パイプライン処理システムのWebアプリケーション（Streamlitベース）の開発進捗を管理します。

**最終更新**: 2025年1月

---

## 全体進捗

- **開始日**: 2025年1月
- **現在のフェーズ**: Phase 1.6 - テスト・デバッグ
- **全体進捗率**: 85%

---

## Phase 1: 基本機能の実装

### Phase 1.1: プロジェクトセットアップ（1日）

**目標**: 開発環境のセットアップと基本的なプロジェクト構造の作成

**進捗**: 100% ✅

#### タスク一覧

- [x] 開発環境のセットアップ
- [x] プロジェクト構造の作成
- [x] 必要なライブラリのインストール
- [x] 基本的なStreamlitアプリの作成
- [x] 設定ファイルの作成

**成果物**:
- [x] `app.py`（基本的な構造）
- [x] `requirements.txt`
- [x] `.streamlit/config.toml`
- [x] `utils/`ディレクトリ構造
- [x] `utils/file_handler.py`（ファイル操作ユーティリティ）
- [x] `utils/pipeline.py`（パイプライン実行ユーティリティ）

**備考**:
- 基本的なプロジェクト構造を作成完了
- Streamlitアプリの基本フレームワークを実装
- ファイル操作とパイプライン実行のユーティリティ関数を実装

---

### Phase 1.2: 基本機能の実装（1週間）

**目標**: XMLファイルのアップロード、変換スクリプトの選択、パイプライン処理の実行など、基本的な機能を実装

**進捗**: 100% ✅

#### FR-001: XMLファイルのアップロード

- [x] ファイルアップロードUIの実装
- [x] ファイル検証（拡張子、サイズ）
- [x] ファイル情報の表示

#### FR-002: 変換スクリプトの選択

- [x] スクリプト一覧の表示
- [x] スクリプト選択UI（multiselect）
- [x] スクリプト説明の表示

#### FR-003: パイプライン処理の実行

- [x] `utils/pipeline.py`の実装
- [x] パイプライン実行ロジック
- [x] エラーハンドリング

#### FR-004: 処理済みXMLファイルのダウンロード

- [x] ダウンロードボタンの実装
- [x] ファイル名の生成
- [x] アップロード時のファイル名に「_final」を追加する機能

#### FR-005: 処理進捗の表示

- [x] 進捗バーの実装
- [x] ステップ情報の表示

#### FR-006: エラーメッセージの表示

- [x] エラーメッセージの表示
- [x] エラー詳細の表示

**成果物**:
- [x] `app.py`（基本機能実装）
- [x] `utils/pipeline.py`
- [x] `utils/file_handler.py`

**備考**:
- 基本機能の実装を完了
- StreamlitアプリにXMLファイルアップロード、スクリプト選択、パイプライン実行、ダウンロード機能を実装
- 進捗表示とエラーハンドリングを実装

---

### Phase 1.3: 検証機能の実装（3日）

**目標**: XML構文検証とテキスト内容検証の実装

**進捗**: 100% ✅

#### FR-007: 構文検証の実行

- [x] `utils/validation.py`の実装
- [x] 構文検証の実行
- [x] 検証結果の表示

#### FR-008: テキスト内容検証の実行

- [x] テキスト内容検証の実装
- [x] 検証結果の表示

#### FR-009: 検証レポートの表示

- [x] 検証レポートの表示UI
- [x] レポートのダウンロード（オプション）

**成果物**:
- [x] `utils/validation.py`

**備考**:
- XML構文検証とテキスト内容検証の機能を実装
- 既存の検証スクリプト（validate_xml.py、compare_xml_text_content.py）を統合
- 検証結果を分かりやすく表示するUIを実装

---

### Phase 1.4: ラベル設定機能の実装（1週間）

**目標**: ラベル設定の表示、編集、保存、バリデーション機能の実装

**進捗**: 100% ✅

#### FR-029: ブーリアン型パラメーターの簡易設定（最優先）

- [x] `utils/config_manager.py`の実装
- [x] ブーリアン型パラメーターの読み込み
- [x] チェックボックスUIの実装
- [x] 設定の保存機能

#### FR-023: ラベル設定の表示

- [x] ラベル設定の読み込み
- [x] 設定内容の表示UI
- [x] セクション分け表示

#### FR-027: ラベル設定のバリデーション

- [x] JSONスキーマバリデーションの実装
- [x] カスタムバリデーションの実装
- [x] エラーメッセージの表示

#### FR-025: ラベル設定の保存

- [x] 設定保存機能の実装
- [x] バックアップ機能

#### FR-026: ラベル設定のインポート/エクスポート

- [x] エクスポート機能の実装
- [x] インポート機能の実装
- [x] バリデーション統合

#### FR-024: ラベル設定の編集

- [x] JSONエディタの統合
- [x] 編集UIの実装
- [x] 保存機能の統合

**成果物**:
- [x] `utils/config_manager.py`
- [x] `utils/validation.py`（拡張）
- [x] `pages/02_⚙️_設定.py`

**備考**:
- ラベル設定の表示、編集、保存、バリデーション機能を実装
- ブーリアン型パラメーターの簡易設定UIを実装
- JSONエディタによる直接編集機能を実装
- インポート/エクスポート機能を実装

---

### Phase 1.5: オプション機能の実装（2日）

**目標**: XMLプレビューと中間ファイルダウンロード機能の実装

**進捗**: 100% ✅

#### FR-010: XMLファイルのプレビュー

- [x] XMLプレビューUIの実装
- [x] シンタックスハイライト
- [x] アップロードファイルのプレビュー
- [x] 処理済みファイルのプレビュー

#### FR-011: 中間ファイルのダウンロード

- [x] 中間ファイル一覧の表示
- [x] ダウンロード機能の実装
- [x] ファイル情報の表示（サイズ、ファイル名）
- [x] ZIPファイルとして一括ダウンロード機能

**成果物**:
- [x] `components/xml_preview.py`
- [x] `app.py`（オプション機能統合）

**備考**:
- XMLプレビューコンポーネントを実装し、アップロードファイルと処理済みファイルの両方でプレビュー可能に
- Streamlitの`st.code`を使用してXMLシンタックスハイライトを実現
- 中間ファイル一覧を表示し、各ファイルを個別にダウンロード可能に
- 大きなファイルの場合、最初の500行のみを表示（パフォーマンス考慮）

---

### Phase 1.6: テスト・デバッグ（2日）

**目標**: 単体テストの作成と統合テストの実行、バグ修正

**進捗**: 50% 🔄

- [ ] 単体テストの作成
- [ ] 統合テストの実行
- [x] バグ修正（インポートパスエラーの修正）
- [x] 設定ファイルの整理（未使用パラメーターの削除）
- [x] ドキュメントの更新

#### バグ修正完了項目

- [x] `preprocess_non_first_sentence_to_list.py`のインポートパス修正
- [x] `convert_article_focused.py`のインポートパス修正
- [x] `xml_converter.py`のインポートパス修正
- [x] `analyze_list_column_labels.py`のインポートパス修正
- [x] `convert_paragraph_step3.py`のインポートパス修正
- [x] `convert_paragraph_step4.py`のインポートパス修正

#### 設定ファイルの整理

- [x] `allow_cross_hierarchy_split`パラメーターの削除
- [x] `hierarchy_rules`セクション全体の削除
- [x] `metadata`セクションの削除
- [x] 設定ページからの未使用パラメーターUIの削除

**成果物**:
- [ ] `tests/`ディレクトリ
- [ ] テストレポート

---

## 実装タスクの詳細

### 優先度: 高（必須）

| タスクID | 機能ID | タスク名 | 見積もり | 状態 | 完了日 |
|---------|--------|---------|---------|------|--------|
| T-001 | FR-001 | XMLファイルのアップロード | 0.5日 | 完了 | 2025年1月 |
| T-002 | FR-002 | 変換スクリプトの選択 | 0.5日 | 完了 | 2025年1月 |
| T-003 | FR-003 | パイプライン処理の実行 | 2日 | 完了 | 2025年1月 |
| T-004 | FR-004 | 処理済みXMLファイルのダウンロード | 0.5日 | 完了 | 2025年1月 |
| T-004-1 | FR-004 | ダウンロードファイル名の改善（_final追加） | 0.5日 | 完了 | 2025年1月 |
| T-005 | FR-005 | 処理進捗の表示 | 1日 | 完了 | 2025年1月 |
| T-006 | FR-006 | エラーメッセージの表示 | 1日 | 完了 | 2025年1月 |
| T-007 | FR-007 | 構文検証の実行 | 1日 | 完了 | 2025年1月 |
| T-008 | FR-008 | テキスト内容検証の実行 | 1日 | 完了 | 2025年1月 |
| T-009 | FR-009 | 検証レポートの表示 | 1日 | 完了 | 2025年1月 |
| T-010 | FR-029 | ブーリアン型パラメーターの簡易設定 | 1日 | 完了 | 2025年1月 |
| T-011 | FR-023 | ラベル設定の表示 | 1日 | 完了 | 2025年1月 |
| T-012 | FR-027 | ラベル設定のバリデーション | 1日 | 完了 | 2025年1月 |
| T-013 | FR-025 | ラベル設定の保存 | 0.5日 | 完了 | 2025年1月 |
| T-014 | FR-026 | ラベル設定のインポート/エクスポート | 1日 | 完了 | 2025年1月 |
| T-015 | FR-024 | ラベル設定の編集 | 2日 | 完了 | 2025年1月 |
| T-018 | - | インポートパスエラーの修正 | 1日 | 完了 | 2025年1月 |
| T-019 | - | 設定ファイルの整理（未使用パラメーター削除） | 0.5日 | 完了 | 2025年1月 |

### 優先度: 中（推奨）

| タスクID | 機能ID | タスク名 | 見積もり | 状態 | 完了日 |
|---------|--------|---------|---------|------|--------|
| T-016 | FR-010 | XMLファイルのプレビュー | 1日 | 完了 | 2025年1月 |
| T-017 | FR-011 | 中間ファイルのダウンロード | 1日 | 完了 | 2025年1月 |

---

## 課題・リスク

### 現在の課題

なし

### リスク管理

| リスクID | リスク内容 | 影響度 | 発生確率 | 対策 | 状態 |
|---------|-----------|--------|---------|------|------|
| R-001 | 既存スクリプトとの統合に問題が発生 | 高 | 中 | 既存スクリプトの動作確認を事前に実施 | 未発生 |
| R-002 | パフォーマンスの問題 | 中 | 中 | キャッシュ機能の実装、非同期処理の検討 | 未発生 |
| R-003 | 設定ファイルの読み込みエラー | 中 | 低 | エラーハンドリングの徹底、デフォルト設定の準備 | 未発生 |
| R-004 | ライブラリの互換性問題 | 低 | 低 | バージョンを固定、テスト環境での確認 | 未発生 |

---

## 変更履歴

| 日付 | 変更内容 | 担当 |
|------|---------|------|
| 2025年1月 | 進捗管理ドキュメント作成 | - |
| 2025年1月 | Phase 1.1: プロジェクトセットアップ完了 | - |
| 2025年1月 | Phase 1.2: 基本機能の実装完了 | - |
| 2025年1月 | Phase 1.3: 検証機能の実装完了 | - |
| 2025年1月 | Phase 1.4: ラベル設定機能の実装完了 | - |
| 2025年1月 | Phase 1.5: オプション機能の実装完了（XMLプレビュー、中間ファイルダウンロード） | - |
| 2025年1月 | Phase 1.6: バグ修正（インポートパスエラー修正、設定ファイル整理） | - |
| 2025年1月 | FR-004改善: ダウンロードファイル名に「_final」を追加 | - |

---

## 次のアクション

1. Phase 1.6: 単体テストの作成
2. Phase 1.6: 統合テストの実行
3. Phase 1.5: オプション機能の実装（XMLプレビュー、中間ファイルダウンロード）

