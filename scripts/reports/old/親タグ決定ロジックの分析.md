# è¦ªã‚¿ã‚°æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†æã¨æ”¹å–„

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥

---

## ğŸ“Š ç¾åœ¨ã®çŠ¶æ³

### ç¾åœ¨ã®å®Ÿè£…ï¼ˆå•é¡Œã‚ã‚Šï¼‰
```python
# ãã®ä»–ã®éšå±¤ãƒ¬ãƒ™ãƒ«ï¼ˆ2-6ï¼‰
elif level >= 2:
    # â˜… å•é¡Œ: å¸¸ã«Paragraphã‚’è¦ªã¨ã™ã‚‹
    actual_parent_tag = 'Paragraph'
    
    element_type = self.determine_element_type(label, actual_parent_tag)
```

### çµæœ
| é …ç›® | æœŸå¾…å€¤ | å®Ÿè£…çµæœ | å·®åˆ† |
|------|--------|----------|------|
| Itemè¦ç´  | 258å€‹ | 321å€‹ | **+63å€‹**ï¼ˆéå‰°ï¼‰ |
| Paragraphè¦ç´  | 111å€‹ | 100å€‹ | **-11å€‹**ï¼ˆä¸è¶³ï¼‰ |

---

## ğŸ” å•é¡Œã®è©³ç´°åˆ†æ

### ä¾‹: æ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠï¼ˆãƒ¬ãƒ™ãƒ«4ï¼‰ã®å‡¦ç†

#### ã‚±ãƒ¼ã‚¹1: Paragraphç›´ä¸‹ã®æ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠ
```xml
<Paragraph>
  <List>
    <Column><Sentence>ï¼ˆã‚¢ï¼‰</Sentence></Column>  <!-- ãƒ¬ãƒ™ãƒ«4 -->
    <Column><Sentence>...</Sentence></Column>
  </List>
</Paragraph>

â†’ è¦ªã‚¿ã‚°='Paragraph', ãƒ¬ãƒ™ãƒ«4 â†’ Subitem2 âœ…æ­£ã—ã„
```

#### ã‚±ãƒ¼ã‚¹2: Itemå†…ã®æ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠï¼ˆæœ¬æ¥ã®æ§‹é€ ï¼‰
```xml
<Paragraph>
  <Item Num="1">  <!-- ãƒ©ãƒ™ãƒ«ï¼ˆï¼‘ï¼‰ã§ä½œæˆã•ã‚ŒãŸItem -->
    <ItemTitle>ï¼ˆï¼‘ï¼‰</ItemTitle>
    <ItemSentence>...</ItemSentence>
    
    <!-- â˜… ã“ã“ã«æ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠãŒæ¥ã‚‹ -->
    <List>
      <Column><Sentence>ï¼ˆã‚¢ï¼‰</Sentence></Column>  <!-- ãƒ¬ãƒ™ãƒ«4 -->
      <Column><Sentence>...</Sentence></Column>
    </List>
  </Item>
</Paragraph>

â†’ æœ¬æ¥: è¦ªã‚¿ã‚°='Item', ãƒ¬ãƒ™ãƒ«4 â†’ Subitem2 âœ…
â†’ ç¾åœ¨: è¦ªã‚¿ã‚°='Paragraph', ãƒ¬ãƒ™ãƒ«4 â†’ Subitem2 âœ…ï¼ˆçµæœçš„ã«åŒã˜ï¼‰
```

#### ã‚±ãƒ¼ã‚¹3: Itemå†…ã®ã‚«ã‚¿ã‚«ãƒŠï¼ˆæœ¬æ¥ã®æ§‹é€ ï¼‰
```xml
<Paragraph>
  <Item Num="1">  <!-- ãƒ©ãƒ™ãƒ«ï¼ˆï¼‘ï¼‰ã§ä½œæˆã•ã‚ŒãŸItem -->
    <ItemTitle>ï¼ˆï¼‘ï¼‰</ItemTitle>
    <ItemSentence>...</ItemSentence>
    
    <!-- â˜… ã“ã“ã«ã‚«ã‚¿ã‚«ãƒŠãŒæ¥ã‚‹ -->
    <List>
      <Column><Sentence>ã‚¢</Sentence></Column>  <!-- ãƒ¬ãƒ™ãƒ«3 -->
      <Column><Sentence>...</Sentence></Column>
    </List>
  </Item>
</Paragraph>

â†’ æœ¬æ¥: è¦ªã‚¿ã‚°='Item', ãƒ¬ãƒ™ãƒ«3 â†’ Subitem1 âœ…
â†’ ç¾åœ¨: è¦ªã‚¿ã‚°='Paragraph', ãƒ¬ãƒ™ãƒ«3 â†’ Subitem1 âœ…ï¼ˆçµæœçš„ã«åŒã˜ï¼‰
```

#### ã‚±ãƒ¼ã‚¹4: å•é¡ŒãŒç™ºç”Ÿã™ã‚‹ã‚±ãƒ¼ã‚¹
```xml
<Paragraph>
  <Item Num="1">
    <ItemTitle>ï¼ˆï¼‘ï¼‰</ItemTitle>
    <ItemSentence>...</ItemSentence>
    
    <!-- â˜… Subitem1ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹çŠ¶æ…‹ã§ -->
    <Subitem1 Num="1">
      <Subitem1Title>ã‚¢</Subitem1Title>
      <Subitem1Sentence>...</Subitem1Sentence>
      
      <!-- â˜… ã•ã‚‰ã«æ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠãŒæ¥ã‚‹ -->
      <List>
        <Column><Sentence>ï¼ˆã‚¢ï¼‰</Sentence></Column>  <!-- ãƒ¬ãƒ™ãƒ«4 -->
        <Column><Sentence>...</Sentence></Column>
      </List>
    </Subitem1>
  </Item>
</Paragraph>

â†’ æœ¬æ¥: è¦ªã‚¿ã‚°='Subitem1', ãƒ¬ãƒ™ãƒ«4 â†’ Subitem2 âœ…ï¼ˆSubitem1å†…ï¼‰
â†’ ç¾åœ¨: è¦ªã‚¿ã‚°='Paragraph', ãƒ¬ãƒ™ãƒ«4 â†’ Subitem2 âœ…ï¼ˆParagraphç›´ä¸‹ï¼‰â†ä½ç½®ãŒé–“é•ã„ï¼
```

---

## ğŸ¯ æ­£ã—ã„è¦ªã‚¿ã‚°æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯

### åŸå‰‡
1. **current_itemãŒå­˜åœ¨ã™ã‚‹å ´åˆ**: ç¾åœ¨ä½œæˆä¸­ã®Itemå†…ã«è¦ç´ ã‚’é…ç½®
2. **hierarchy_context['parent_tag']ã‚’å‚ç…§**: ç¾åœ¨ã®éšå±¤çŠ¶æ…‹ã‚’åæ˜ 
3. **æ•°å­—ãƒ©ãƒ™ãƒ«ï¼ˆãƒ¬ãƒ™ãƒ«1ï¼‰ã®å ´åˆ**: æ–°ã—ã„Paragraphãªã®ã§ãƒªã‚»ãƒƒãƒˆ

### æ”¹å–„æ¡ˆ

```python
elif level >= 2:
    # â˜… ã‚ˆã‚Šè³¢ã„è¦ªã‚¿ã‚°æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯
    
    # ç¾åœ¨ã®Item/Subitemã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºèª
    if hierarchy_context['current_parent'] is not None:
        # éšå±¤ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆã€ãã®è¦ªã‚¿ã‚°ã‚’ä½¿ç”¨
        actual_parent_tag = hierarchy_context['parent_tag']
    elif current_item is not None:
        # current_itemãŒã‚ã‚‹å ´åˆã¯Itemç›´ä¸‹
        actual_parent_tag = 'Item'
    else:
        # ã©ã¡ã‚‰ã‚‚ãªã„å ´åˆã¯Paragraphç›´ä¸‹
        actual_parent_tag = 'Paragraph'
    
    element_type = self.determine_element_type(label, actual_parent_tag)
```

---

## ğŸ“‹ å®Ÿè£…ã®è©³ç´°

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®è¿½è·¡

ç¾åœ¨ã€ä»¥ä¸‹ã®å¤‰æ•°ã§éšå±¤ã‚’è¿½è·¡ã—ã¦ã„ã¾ã™ï¼š

```python
hierarchy_context = {
    'current_parent': None,      # ç¾åœ¨ã®è¦ªè¦ç´ ï¼ˆElementTreeè¦ç´ ï¼‰
    'parent_tag': 'Paragraph',   # è¦ªè¦ç´ ã®ã‚¿ã‚°å
    'counters': {                # å„éšå±¤ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
        'Item': 0,
        'Subitem1': 0,
        'Subitem2': 0,
        ...
    }
}

current_item = None  # ç¾åœ¨ã®Itemè¦ç´ 
```

### è¦ªã‚¿ã‚°ã®æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°

#### Itemè¦ç´ ã‚’ä½œæˆã—ãŸæ™‚
```python
if element_type == 'Item':
    new_elem = self.create_item_element(label, content_elem, counter)
    current_paragraph.append(new_elem)
    current_item = new_elem
    
    # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
    hierarchy_context['current_parent'] = new_elem
    hierarchy_context['parent_tag'] = 'Item'  # â˜…ã“ã“ã§'Item'ã«æ›´æ–°
```

#### Subitemè¦ç´ ã‚’ä½œæˆã—ãŸæ™‚
```python
elif element_type.startswith('Subitem'):
    new_elem = self.create_subitem_element(element_type, label, content_elem, counter)
    
    # è¦ªè¦ç´ ã«è¿½åŠ ï¼ˆhierarchy_context['current_parent']ï¼‰
    ...
    
    # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
    hierarchy_context['current_parent'] = new_elem
    hierarchy_context['parent_tag'] = element_type  # â˜…ã“ã“ã§'Subitem1'ç­‰ã«æ›´æ–°
```

---

## âœ… ä¿®æ­£å†…å®¹

### Beforeï¼ˆå•é¡Œã‚ã‚Šï¼‰
```python
elif level >= 2:
    actual_parent_tag = 'Paragraph'  # â˜…å¸¸ã«Paragraph
    element_type = self.determine_element_type(label, actual_parent_tag)
```

### Afterï¼ˆæ”¹å–„ç‰ˆï¼‰
```python
elif level >= 2:
    # â˜…ã‚ˆã‚Šè³¢ã„è¦ªã‚¿ã‚°æ±ºå®š
    if hierarchy_context['current_parent'] is not None:
        # éšå±¤ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹ â†’ ãã®è¦ªã‚¿ã‚°ã‚’ä½¿ç”¨
        actual_parent_tag = hierarchy_context['parent_tag']
    elif current_item is not None:
        # current_itemãŒã‚ã‚‹ â†’ Itemç›´ä¸‹
        actual_parent_tag = 'Item'
    else:
        # ã©ã¡ã‚‰ã‚‚ãªã„ â†’ Paragraphç›´ä¸‹
        actual_parent_tag = 'Paragraph'
    
    element_type = self.determine_element_type(label, actual_parent_tag)
```

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„

### ä¿®æ­£å‰
```
Itemè¦ç´ : 321å€‹ï¼ˆæœŸå¾…å€¤258å€‹ã‚ˆã‚Š+63å€‹éå‰°ï¼‰
â†’ æœ¬æ¥Subitemå†…ã«é…ç½®ã™ã¹ãè¦ç´ ãŒItem/Paragraphç›´ä¸‹ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹
```

### ä¿®æ­£å¾Œï¼ˆæœŸå¾…ï¼‰
```
Itemè¦ç´ : ç´„258å€‹ï¼ˆæœŸå¾…å€¤ã«è¿‘ã¥ãï¼‰
Subitem1-3è¦ç´ : æœŸå¾…å€¤ã«è¿‘ã¥ã
éšå±¤æ§‹é€ : ã‚ˆã‚Šæ­£ç¢ºã«ãªã‚‹
```

---

## ğŸ”§ å®Ÿè£…æ‰‹é †

1. **1007-1017è¡Œç›®ã®ä¿®æ­£**: è¦ªã‚¿ã‚°æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯ã®æ”¹å–„
2. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: test_input5.xmlã§å¤‰æ›
3. **çµæœæ¯”è¼ƒ**: test_output5.xmlã¨æ¯”è¼ƒ
4. **å¾®èª¿æ•´**: å¿…è¦ã«å¿œã˜ã¦ã•ã‚‰ãªã‚‹èª¿æ•´

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥  
**ãƒ•ã‚¡ã‚¤ãƒ«**: `/Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script/reports/è¦ªã‚¿ã‚°æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†æ.md`

