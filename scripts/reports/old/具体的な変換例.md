# å…·ä½“çš„ãªå¤‰æ›ä¾‹ï¼štest_input5.xml â†’ test_output5.xml

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥

---

## ğŸ“ å¯¾è±¡ç®‡æ‰€ã®ç‰¹å®š

### test_input5.xmlï¼ˆ48-100è¡Œç›®ä»˜è¿‘ï¼‰

```xml
<Paragraph Num="1">
  <ParagraphNum>ï¼‘</ParagraphNum>
  <ParagraphSentence>
    <Sentence Num="1">å„å­¦æ ¡ã«ãŠã„ã¦ã¯ï¼Œæ•™è‚²åŸºæœ¬æ³•åŠã³å­¦æ ¡æ•™è‚²æ³•ãã®ä»–ã®æ³•ä»¤...</Sentence>
  </ParagraphSentence>
  
  <!-- â˜… ä»¥ä¸‹ã®Columnæ§‹é€ ã‚ã‚ŠListè¦ç´ ãŒå¤‰æ›å¯¾è±¡ -->
  
  <List>  <!-- 53-62è¡Œç›® -->
    <ListSentence>
      <Column Num="1">
        <Sentence Num="1">ï¼’</Sentence>  <!-- â˜… ãƒ©ãƒ™ãƒ«: æ•°å­— â†’ æ–°ã—ã„Paragraph -->
      </Column>
      <Column Num="2">
        <Sentence Num="1">å­¦æ ¡ã®æ•™è‚²æ´»å‹•ã‚’é€²ã‚ã‚‹ã«å½“ãŸã£ã¦ã¯ï¼Œ...</Sentence>
      </Column>
    </ListSentence>
  </List>
  
  <List>  <!-- 63-72è¡Œç›® -->
    <ListSentence>
      <Column Num="1">
        <Sentence Num="1">ï¼ˆï¼‘ï¼‰</Sentence>  <!-- â˜… ãƒ©ãƒ™ãƒ«: æ‹¬å¼§æ•°å­— â†’ Item -->
      </Column>
      <Column Num="2">
        <Sentence Num="1">åŸºç¤çš„ãƒ»åŸºæœ¬çš„ãªçŸ¥è­˜åŠã³æŠ€èƒ½ã‚’ç¢ºå®Ÿã«ç¿’å¾—ã•ã›ï¼Œ...</Sentence>
      </Column>
    </ListSentence>
  </List>
  
  <List>  <!-- 73-82è¡Œç›® -->
    <ListSentence>
      <Column Num="1">
        <Sentence Num="1">ï¼ˆï¼’ï¼‰</Sentence>  <!-- â˜… ãƒ©ãƒ™ãƒ«: æ‹¬å¼§æ•°å­— â†’ Item -->
      </Column>
      <Column Num="2">
        <Sentence Num="1">é“å¾³æ•™è‚²ã‚„ä½“é¨“æ´»å‹•ï¼Œå¤šæ§˜ãªè¡¨ç¾ã‚„é‘‘è³ã®æ´»å‹•ç­‰...</Sentence>
      </Column>
    </ListSentence>
  </List>
  
  <!-- Columnæ§‹é€ ãªã—ã®Listï¼ˆé•·æ–‡ï¼‰ -->
  <List>  <!-- 83-87è¡Œç›® -->
    <ListSentence>
      <Sentence Num="1">å­¦æ ¡ã«ãŠã‘ã‚‹é“å¾³æ•™è‚²ã¯ï¼Œäººé–“ã¨ã—ã¦ã®åœ¨ã‚Šæ–¹...</Sentence>
    </ListSentence>
  </List>
  
  <!-- ã•ã‚‰ã«Columnæ§‹é€ ã‚ã‚ŠListãŒç¶šã: ï¼ˆï¼“ï¼‰ã€ï¼ˆï¼”ï¼‰ãªã© -->
  <List>
    <ListSentence>
      <Column Num="1"><Sentence Num="1">ï¼ˆï¼“ï¼‰</Sentence></Column>
      <Column Num="2"><Sentence Num="1">å­¦æ ¡ã«ãŠã‘ã‚‹ä½“è‚²ãƒ»å¥åº·ã«é–¢ã™ã‚‹æŒ‡å°ã‚’ï¼Œ...</Sentence></Column>
    </ListSentence>
  </List>
  
  <List>
    <ListSentence>
      <Column Num="1"><Sentence Num="1">ï¼ˆï¼”ï¼‰</Sentence></Column>
      <Column Num="2"><Sentence Num="1">å­¦æ ¡ã«ãŠã‘ã‚‹è‡ªç«‹æ´»å‹•ã®æŒ‡å°ã¯ï¼Œ...</Sentence></Column>
    </ListSentence>
  </List>
</Paragraph>
```

---

## âœ… æœŸå¾…ã•ã‚Œã‚‹å¤‰æ›çµæœ

### test_output5.xmlï¼ˆ38-88è¡Œç›®ï¼‰

```xml
<!-- â˜… å…ƒã®Paragraph[1]ã¯ä¿æŒã€ParagraphSentenceã¾ã§ -->
<Paragraph Num="1">
  <ParagraphNum>ï¼‘</ParagraphNum>
  <ParagraphSentence>
    <Sentence Num="1">å„å­¦æ ¡ã«ãŠã„ã¦ã¯ï¼Œæ•™è‚²åŸºæœ¬æ³•åŠã³å­¦æ ¡æ•™è‚²æ³•ãã®ä»–ã®æ³•ä»¤...</Sentence>
  </ParagraphSentence>
</Paragraph>

<!-- â˜… ãƒ©ãƒ™ãƒ«ã€Œï¼’ã€ï¼ˆæ•°å­—ï¼‰ã¯æ–°ã—ã„Paragraphè¦ç´ ã«ãªã‚‹ -->
<Paragraph Num="2">
  <ParagraphNum>ï¼’</ParagraphNum>
  <ParagraphSentence>
    <Sentence Num="1">å­¦æ ¡ã®æ•™è‚²æ´»å‹•ã‚’é€²ã‚ã‚‹ã«å½“ãŸã£ã¦ã¯ï¼Œ...</Sentence>
  </ParagraphSentence>
  
  <!-- â˜… ãƒ©ãƒ™ãƒ«ã€Œï¼ˆï¼‘ï¼‰ã€ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ã¯Itemè¦ç´ ã«ãªã‚‹ -->
  <Item Num="1">
    <ItemTitle>ï¼ˆï¼‘ï¼‰</ItemTitle>
    <ItemSentence>
      <Sentence Num="1">åŸºç¤çš„ãƒ»åŸºæœ¬çš„ãªçŸ¥è­˜åŠã³æŠ€èƒ½ã‚’ç¢ºå®Ÿã«ç¿’å¾—ã•ã›ï¼Œ...</Sentence>
    </ItemSentence>
  </Item>
  
  <!-- â˜… ãƒ©ãƒ™ãƒ«ã€Œï¼ˆï¼’ï¼‰ã€ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ã¯Itemè¦ç´ ã«ãªã‚‹ -->
  <Item Num="2">
    <ItemTitle>ï¼ˆï¼’ï¼‰</ItemTitle>
    <ItemSentence>
      <Sentence Num="1">é“å¾³æ•™è‚²ã‚„ä½“é¨“æ´»å‹•ï¼Œå¤šæ§˜ãªè¡¨ç¾ã‚„é‘‘è³ã®æ´»å‹•ç­‰...</Sentence>
    </ItemSentence>
    
    <!-- â˜… Columnæ§‹é€ ãªã—ã®Listè¦ç´ ã¯ã€Itemå†…ã«Listè¦ç´ ã¨ã—ã¦ä¿æŒ -->
    <List>
      <ListSentence>
        <Sentence Num="1">å­¦æ ¡ã«ãŠã‘ã‚‹é“å¾³æ•™è‚²ã¯ï¼Œäººé–“ã¨ã—ã¦ã®åœ¨ã‚Šæ–¹...</Sentence>
      </ListSentence>
    </List>
    <List>
      <ListSentence>
        <Sentence Num="1">é“å¾³æ•™è‚²ã¯ï¼Œæ•™è‚²åŸºæœ¬æ³•åŠã³å­¦æ ¡æ•™è‚²æ³•ã«...</Sentence>
      </ListSentence>
    </List>
    <List>
      <ListSentence>
        <Sentence Num="1">é“å¾³æ•™è‚²ã‚’é€²ã‚ã‚‹ã«å½“ãŸã£ã¦ã¯ï¼Œäººé–“å°Šé‡ã®...</Sentence>
      </ListSentence>
    </List>
  </Item>
  
  <!-- â˜… ãƒ©ãƒ™ãƒ«ã€Œï¼ˆï¼“ï¼‰ã€ã¯Itemè¦ç´  -->
  <Item Num="3">
    <ItemTitle>ï¼ˆï¼“ï¼‰</ItemTitle>
    <ItemSentence>
      <Sentence Num="1">å­¦æ ¡ã«ãŠã‘ã‚‹ä½“è‚²ãƒ»å¥åº·ã«é–¢ã™ã‚‹æŒ‡å°ã‚’ï¼Œ...</Sentence>
    </ItemSentence>
  </Item>
  
  <!-- â˜… ãƒ©ãƒ™ãƒ«ã€Œï¼ˆï¼”ï¼‰ã€ã¯Itemè¦ç´  -->
  <Item Num="4">
    <ItemTitle>ï¼ˆï¼”ï¼‰</ItemTitle>
    <ItemSentence>
      <Sentence Num="1">å­¦æ ¡ã«ãŠã‘ã‚‹è‡ªç«‹æ´»å‹•ã®æŒ‡å°ã¯ï¼Œ...</Sentence>
    </ItemSentence>
  </Item>
</Paragraph>
```

---

## ğŸ¯ å¤‰æ›ãƒ«ãƒ¼ãƒ«

### 1. Paragraphå†…ã®Columnæ§‹é€ ã‚ã‚ŠListè¦ç´ ã®å‡¦ç†

| ãƒ©ãƒ™ãƒ« | éšå±¤ãƒ¬ãƒ™ãƒ« | å¤‰æ›å…ˆè¦ç´  | èª¬æ˜ |
|--------|-----------|-----------|------|
| **ã€Œï¼’ã€** | ãƒ¬ãƒ™ãƒ«1ï¼ˆæ•°å­—ï¼‰ | **æ–°ã—ã„Paragraph** | Paragraphåˆ†å‰²ãŒç™ºç”Ÿ |
| **ã€Œï¼ˆï¼‘ï¼‰ã€** | ãƒ¬ãƒ™ãƒ«2ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ | **Item** | Paragraphå†…ã®Itemè¦ç´  |
| **ã€Œï¼ˆï¼’ï¼‰ã€** | ãƒ¬ãƒ™ãƒ«2ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ | **Item** | Paragraphå†…ã®Itemè¦ç´  |
| **ã€Œï¼ˆï¼“ï¼‰ã€** | ãƒ¬ãƒ™ãƒ«2ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ | **Item** | Paragraphå†…ã®Itemè¦ç´  |
| **ã€Œï¼ˆï¼”ï¼‰ã€** | ãƒ¬ãƒ™ãƒ«2ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ | **Item** | Paragraphå†…ã®Itemè¦ç´  |

### 2. Columnæ§‹é€ ãªã—Listè¦ç´ ã®å‡¦ç†

```
Columnæ§‹é€ ãªã—ï¼ˆé•·æ–‡ï¼‰â†’ ç›´å‰ã®Itemè¦ç´ å†…ã«Listè¦ç´ ã¨ã—ã¦ä¿æŒ
```

ä¾‹: ã€Œå­¦æ ¡ã«ãŠã‘ã‚‹é“å¾³æ•™è‚²ã¯...ã€ã¨ã„ã†é•·æ–‡ã¯ã€Item[2]ã€Œï¼ˆï¼’ï¼‰ã€ã®ä¸­ã«Listè¦ç´ ã¨ã—ã¦é…ç½®ã•ã‚Œã‚‹ã€‚

---

## ğŸ› ç¾åœ¨ã®å•é¡Œ

### ç¾åœ¨ã®å®Ÿè£…ã®å‹•ä½œ

```python
def convert_paragraph_structure(self, root: ET.Element):
    for child in all_children:
        if child.tag == 'Paragraph':
            # â˜… æ—¢å­˜ã®Paragraphè¦ç´ ã‚’ãã®ã¾ã¾è¿½åŠ 
            result_paragraphs.append(child)
            continue
```

**çµæœ**:
```xml
<!-- test_output5_å®Ÿè£…çµæœ.xmlã®çŠ¶æ…‹ -->
<Paragraph Num="1">
  <ParagraphNum>ï¼‘</ParagraphNum>
  <ParagraphSentence>...</ParagraphSentence>
  
  <!-- â˜… Listè¦ç´ ãŒãã®ã¾ã¾æ®‹ã£ã¦ã„ã‚‹ï¼ -->
  <List>
    <ListSentence>
      <Column Num="1"><Sentence>ï¼’</Sentence></Column>
      <Column Num="2"><Sentence>å­¦æ ¡ã®æ•™è‚²æ´»å‹•ã‚’...</Sentence></Column>
    </ListSentence>
  </List>
  <List>
    <ListSentence>
      <Column Num="1"><Sentence>ï¼ˆï¼‘ï¼‰</Sentence></Column>
      <Column Num="2"><Sentence>åŸºç¤çš„ãƒ»åŸºæœ¬çš„ãª...</Sentence></Column>
    </ListSentence>
  </List>
  <!-- ... ä»–ã®Listè¦ç´ ã‚‚å¤‰æ›ã•ã‚Œã¦ã„ãªã„ -->
</Paragraph>
```

**å•é¡Œ**: æ—¢å­˜ã®Paragraphå†…ã®Listè¦ç´ ãŒä¸€åˆ‡å¤‰æ›ã•ã‚Œã¦ã„ãªã„ï¼

---

## ğŸ”§ å¿…è¦ãªä¿®æ­£

### convert_paragraph_content()ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ 

```python
def convert_paragraph_content(self, paragraph: ET.Element) -> List[ET.Element]:
    """
    æ—¢å­˜ã®Paragraphè¦ç´ å†…ã®Listè¦ç´ ã‚’Item/Subiteméšå±¤ã«å¤‰æ›
    
    Args:
        paragraph: æ—¢å­˜ã®Paragraphè¦ç´ 
    
    Returns:
        å¤‰æ›å¾Œã®Paragraphè¦ç´ ã®ãƒªã‚¹ãƒˆï¼ˆåˆ†å‰²ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰
    """
    result_paragraphs = []
    
    # ParagraphNum/ParagraphSentenceã‚’å–å¾—
    para_num_elem = paragraph.find('ParagraphNum')
    para_sentence_elem = paragraph.find('ParagraphSentence')
    
    # ç¾åœ¨ã®Paragraphã‚’ä½œæˆ
    current_paragraph = ET.Element('Paragraph', paragraph.attrib)
    if para_num_elem is not None:
        current_paragraph.append(copy.deepcopy(para_num_elem))
    if para_sentence_elem is not None:
        current_paragraph.append(copy.deepcopy(para_sentence_elem))
    
    result_paragraphs.append(current_paragraph)
    
    # Listè¦ç´ ã‚’å‡¦ç†
    item_counter = 0
    
    for list_elem in paragraph.findall('List'):
        columns = self.extract_columns(list_elem)
        
        if columns and len(columns) >= 2:
            label = columns[0][0]
            content_elem = columns[1][1]
            level = self.get_hierarchy_level(label)
            
            # ãƒ¬ãƒ™ãƒ«1ï¼ˆæ•°å­—ï¼‰ã®å ´åˆã€æ–°ã—ã„Paragraphã‚’ä½œæˆ
            if level == 1:
                # æ–°ã—ã„Paragraphã‚’ä½œæˆ
                new_paragraph = ET.Element('Paragraph', attrib={'Num': '0'})  # Numã¯å¾Œã§å†æ¡ç•ª
                
                para_num_new = ET.SubElement(new_paragraph, 'ParagraphNum')
                para_num_new.text = label
                
                para_sentence_new = ET.SubElement(new_paragraph, 'ParagraphSentence')
                sentence_copy = copy.deepcopy(content_elem)
                sentence_copy.set('Num', '1')
                para_sentence_new.append(sentence_copy)
                
                result_paragraphs.append(new_paragraph)
                current_paragraph = new_paragraph
                item_counter = 0
                
            # ãƒ¬ãƒ™ãƒ«2ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ã®å ´åˆã€Itemè¦ç´ ã‚’ä½œæˆ
            elif level == 2:
                item_counter += 1
                item = self.create_item_element(label, content_elem, item_counter)
                current_paragraph.append(item)
                
            # ãƒ¬ãƒ™ãƒ«3ä»¥é™ï¼ˆã‚«ã‚¿ã‚«ãƒŠãªã©ï¼‰ã®å ´åˆã€Subitemè¦ç´ ã‚’ä½œæˆ
            # ...
        else:
            # Columnæ§‹é€ ãªã— â†’ ç›´å‰ã®Itemè¦ç´ å†…ã«è¿½åŠ 
            items = current_paragraph.findall('Item')
            if items:
                last_item = items[-1]
                list_elem_new = self.create_list_element(list_elem.find('.//Sentence'))
                last_item.append(list_elem_new)
    
    return result_paragraphs
```

### convert_paragraph_structure()ã®ä¿®æ­£

```python
def convert_paragraph_structure(self, root: ET.Element):
    for article_or_subsection in ...:
        all_children = list(article_or_subsection)
        result_paragraphs = []
        
        for child in all_children:
            if child.tag == 'Paragraph':
                # â˜… æ—¢å­˜ã®Paragraphå†…ã®Listè¦ç´ ã‚’å‡¦ç†
                converted_paras = self.convert_paragraph_content(child)
                result_paragraphs.extend(converted_paras)
                continue
            # ... ä»–ã®å‡¦ç†
```

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### ä¿®æ­£å‰ï¼ˆç¾åœ¨ï¼‰
```
Columnæ§‹é€ ã‚ã‚ŠList: 534å€‹ï¼ˆæœªå‡¦ç†ï¼‰
Itemè¦ç´ : 39å€‹ï¼ˆæ–°è¦ä½œæˆã•ã‚ŒãŸParagraphã®ã¿ï¼‰
```

### ä¿®æ­£å¾Œ
```
Columnæ§‹é€ ã‚ã‚ŠList: 534å€‹ â†’ Item/Subitemè¦ç´ ã«å¤‰æ›
Itemè¦ç´ : ç´„86å€‹ï¼ˆæœŸå¾…å€¤ã¨ä¸€è‡´ï¼‰
Subitem1è¦ç´ : ç´„74å€‹ï¼ˆæœŸå¾…å€¤ã¨ä¸€è‡´ï¼‰
Subitem2è¦ç´ : ç´„82å€‹ï¼ˆæœŸå¾…å€¤ã¨ä¸€è‡´ï¼‰
```

---

## âœ… ã¾ã¨ã‚

### å¯¾è±¡ç®‡æ‰€
- **test_input5.xml**: 48è¡Œç›®ä»¥é™ã®æ—¢å­˜ã®Paragraphè¦ç´ å†…ã®Columnæ§‹é€ ã‚ã‚ŠListè¦ç´ ï¼ˆ534å€‹ï¼‰

### æœŸå¾…ã•ã‚Œã‚‹å¤‰æ›
1. ãƒ©ãƒ™ãƒ«ã€Œï¼’ã€ï¼ˆæ•°å­—ï¼‰â†’ æ–°ã—ã„Paragraphè¦ç´ 
2. ãƒ©ãƒ™ãƒ«ã€Œï¼ˆï¼‘ï¼‰ã€ï½ã€Œï¼ˆï¼”ï¼‰ã€ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰â†’ Itemè¦ç´ 
3. Columnæ§‹é€ ãªã—Listè¦ç´  â†’ Itemè¦ç´ å†…ã®Listè¦ç´ ã¨ã—ã¦ä¿æŒ

### å¿…è¦ãªä¿®æ­£
- `convert_paragraph_content()`ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ 
- `convert_paragraph_structure()`ã§ã®æ—¢å­˜Paragraphå‡¦ç†ã®çµ±åˆ

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥  
**ãƒ•ã‚¡ã‚¤ãƒ«**: `/Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script/reports/å…·ä½“çš„ãªå¤‰æ›ä¾‹.md`

