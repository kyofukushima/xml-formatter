# test_input5.xml と test_output5.xml の検証レポート

**検証日時**: 2025-10-27  
**目的**: 変換ミス（抜け落ち・重複）の確認

---

## 🚨 重大な問題を発見

### 1. Sentence要素数の大幅な減少

| 項目 | test_input5.xml | test_output5.xml | 差分 |
|------|-----------------|------------------|------|
| **Sentence要素総数** | 1,367個 | 865個 | **-502個 (-36.7%)** 🔴 |
| **空でないSentence** | 1,313個 | 771個 | **-542個 (-41.3%)** 🔴 |
| **grep検出数** | 1,303個 | 801個 | **-502個** 🔴 |

**結論**: **約500個のSentence要素が抜け落ちています**

---

### 2. 順序の不一致

最初の10個のSentence要素を比較した結果：

| # | 一致 | Input | Output |
|---|------|-------|--------|
| 1 | ✅ | サンプル告示 | サンプル告示 |
| 2 | ❌ | `１` | 学校教育法第５１条に規定する... |
| 3 | ❌ | 学校教育法第５１条に規定する... | 生徒の障害による学習上又は... |
| 4 | ❌ | `２` | 各学校においては，教育基本法... |
| 5 | ❌ | 生徒の障害による学習上又は... | 学校の教育活動を進めるに... |
| 6 | ❌ | 各学校においては，教育基本法... | 基礎的・基本的な知識及び... |
| 7 | ❌ | `２` | 道徳教育や体験活動，... |
| 8 | ❌ | 学校の教育活動を進めるに... | 学校における道徳教育は，... |
| 9 | ❌ | `（１）` | 道徳教育は，教育基本法... |
| 10 | ❌ | 基礎的・基本的な知識及び... | 道徳教育を進めるに... |

**パターン**: 
- Inputには`１`, `２`, `（１）`等のラベルが独立したSentence要素として存在
- Outputではこれらのラベルが**抜け落ちている**または**Title要素に移動している**

---

### 3. 重複の検出

**Output内で重複しているテキスト**: 48件

主な重複:
- `２`: 34回出現
- `教科`: 5回出現
- `科目`: 5回出現
- `４`: 12回出現
- `３`: 6回出現

**原因**: 数字や記号がTitle要素とSentence要素の両方に現れている可能性

---

### 4. 抜け落ちの詳細

**Inputにあって Outputにないテキスト**: 62件（ユニークなテキスト）

主な抜け落ち:
- `オ`
- `（３）`
- `（４）`
- `（エ）`
- `母子衛生`

**推測**: 
- ラベル（数字、括弧付き数字、カタカナ等）が抜け落ちている
- 一部の項目名が抜け落ちている

---

### 5. 追加されたテキスト

**OutputにあってInputにないテキスト**: 4件

1. `学校においては，第２章以下に示していない事項を加えて指導することができる。また，第２章第１節第１款において準ずるものとしている高等学校学習指導要領第２章及び第３...`
2. `内分泌・代謝異常症`
3. `学校設定科目`
4. `主として専門学科において開設される各教科・科目`

**推測**: 
- 長文が分割された可能性
- または手動で追加された内容

---

## 🔍 詳細分析

### 問題の本質

#### A. ラベルの扱いの違い

**test_input5.xml の構造**:
```xml
<List>
  <ListSentence>
    <Column>
      <Sentence>１</Sentence>  <!-- ラベル -->
    </Column>
    <Column>
      <Sentence>学校教育法第５１条に規定する高等学校教育の目標</Sentence>
    </Column>
  </ListSentence>
</List>
```

**test_output5.xml の構造**:
```xml
<Item Num="1">
  <ItemTitle>１</ItemTitle>  <!-- ラベルはTitleに移動 -->
  <ItemSentence>
    <Sentence>学校教育法第５１条に規定する高等学校教育の目標</Sentence>
  </ItemSentence>
</Item>
```

**Sentence要素の数**:
- Input: 2個（ラベル + 本文）
- Output: 1個（本文のみ）

**これが500個の差分の主要原因です！**

---

#### B. 変換のロジック

Inputでは：
- `List > ListSentence > Column > Sentence` という構造
- ラベルと本文が別々のSentence要素

Outputでは：
- `Item > ItemTitle` と `Item > ItemSentence > Sentence` に変換
- ラベルはItemTitleに移動
- 本文のみがSentence要素に

**結果**: Sentence要素の数が減少（これは正常な変換）

---

### 本当の問題点

上記の分析から、**Sentence要素の減少自体は正常な変換の結果**である可能性が高いです。

しかし、以下の問題は依然として存在します：

1. **抜け落ちの62件のユニークテキスト**
   - これらは本当に抜け落ちているのか？
   - Title要素に移動しているだけなのか？

2. **重複の48件**
   - なぜ同じテキストが複数回出現するのか？

3. **追加された4件のテキスト**
   - これらはどこから来たのか？

---

## ✅ 再検証：Title要素も含めた比較

より正確な検証が必要です。Sentence要素だけでなく、Title要素も含めて全テキストを比較する必要があります。

### 検証すべき項目

1. **全テキスト要素の比較**
   - Sentence, ItemTitle, ParagraphNum, SubitemTitle等、全てのテキスト要素を抽出
   - InputとOutputで全テキストが保持されているか確認

2. **順序の保持**
   - テキストの出現順序が変わっていないか確認

3. **重複の原因**
   - なぜ特定のテキストが重複しているのか調査

4. **抜け落ちの原因**
   - 62件のユニークテキストが本当に存在しないのか確認

---

## 📝 推奨される次のステップ

### Step 1: 全テキスト要素の抽出と比較

```python
# 以下のタグから全テキストを抽出
tags_to_check = [
    'Sentence', 'ItemTitle', 'SubitemTitle', 
    'ParagraphNum', 'ArticleTitle', 'ChapterTitle',
    'SectionTitle', 'SubsectionTitle'
]
```

### Step 2: 順序を保持した比較

InputとOutputで、全テキストが同じ順序で出現するか確認

### Step 3: 具体的な抜け落ち箇所の特定

- 62件のテキストがInputのどこに出現するか
- Outputのどこに移動すべきだったか
- なぜ抜け落ちたのか

### Step 4: 重複の原因調査

- 48件の重複がどのように発生したか
- 変換ロジックの問題か、元データの問題か

---

## ⚠️ 暫定的な結論

### 1. Sentence要素の減少について

**502個の減少は、ほぼ正常な変換の結果と思われます**

理由：
- Inputでは、ラベル（`１`, `２`, `（１）`等）が独立したSentence要素
- Outputでは、ラベルはTitle要素に移動
- 約500個のラベルがあるため、Sentence要素が約500個減少するのは妥当

### 2. しかし、以下は依然として問題

1. **抜け落ちの62件のユニークテキスト** 🔴
   - これらは本当に抜け落ちている可能性
   - 詳細な調査が必要

2. **重複の48件** ⚠️
   - 同じテキストが複数回出現
   - 変換ロジックの問題の可能性

3. **追加された4件のテキスト** ⚠️
   - Inputにない長文がOutputに存在
   - 手動編集または分割の結果？

---

## 🎯 次に必要な作業

1. **全テキスト要素（Title含む）の完全比較**
2. **抜け落ちの62件の詳細調査**
3. **重複の48件の原因特定**
4. **追加された4件の出所確認**

これらを実行して、本当の変換ミスを特定する必要があります。

---

**作成日**: 2025-10-27  
**ファイル**: `/Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script/検証レポート_input_output比較.md`

