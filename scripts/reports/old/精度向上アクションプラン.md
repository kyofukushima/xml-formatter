# ç²¾åº¦å‘ä¸Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

## ğŸ“Š ç¾çŠ¶ã‚µãƒãƒªãƒ¼

### ä¸€è‡´ç‡: 31.5% â†’ ç›®æ¨™: 90%ä»¥ä¸Š

| å•é¡Œã®ç¨®é¡ | å·®åˆ† | å½±éŸ¿åº¦ | å„ªå…ˆåº¦ |
|----------|-----|--------|--------|
| ğŸ”´ Subitem5æœªä½œæˆ | **-166å€‹** | **æœ€å¤§** | **P0ï¼ˆæœ€å„ªå…ˆï¼‰** |
| ğŸ”´ Subitem3éå‰° | **+144å€‹** | å¤§ | **P0ï¼ˆæœ€å„ªå…ˆï¼‰** |
| âš ï¸ Subitem4ä¸è¶³ | -54å€‹ | ä¸­ | P1ï¼ˆé«˜ï¼‰ |
| âš ï¸ Subitem2éå‰° | +38å€‹ | ä¸­ | P1ï¼ˆé«˜ï¼‰ |
| âš ï¸ Iteméå‰° | +21å€‹ | å° | P2ï¼ˆä¸­ï¼‰ |
| âš ï¸ Subitem1ä¸è¶³ | -21å€‹ | å° | P2ï¼ˆä¸­ï¼‰ |
| âš ï¸ Paragraphä¸è¶³ | -5å€‹ | å° | P3ï¼ˆä½ï¼‰ |

**ç·å·®åˆ†: 453å€‹**

---

## ğŸ¯ 3æ®µéšã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### ãƒ•ã‚§ãƒ¼ã‚º1: æœ€å„ªå…ˆèª²é¡Œï¼ˆP0ï¼‰ - æœŸé–“: 1æ—¥

**ç›®æ¨™: ä¸€è‡´ç‡ 31.5% â†’ 56%ï¼ˆ+310å€‹æ”¹å–„ï¼‰**

#### èª²é¡Œ1-1: Subitem5ã‚’ä½œæˆã™ã‚‹ï¼ˆ-166å€‹ â†’ 0å€‹ï¼‰

**å•é¡Œã®è©³ç´°:**
```
å®Ÿéš›: Subitem4ã€Œï¼ˆï¼‘ï¼‰ã€ â†’ ï¼ˆä½•ã‚‚ãªã—ï¼‰
æœŸå¾…: Subitem4ã€Œï¼ˆï¼‘ï¼‰ã€ â†’ Subitem5ã€Œã‚¢ã€
```

**åŸå› :**
- `get_hierarchy_level()`ãŒã‚«ã‚¿ã‚«ãƒŠã€Œã‚¢ã€ã‚’å¸¸ã«level 3ã¨åˆ¤å®š
- Subitem5ã¯level 7ç›¸å½“ã ãŒã€èªè­˜ã•ã‚Œãªã„

**è§£æ±ºç­–:**
```python
# ã‚¹ãƒ†ãƒƒãƒ—1: è¦ªãƒ™ãƒ¼ã‚¹åˆ¤å®šã®è¿½åŠ 
def determine_element_type_improved(self, label, parent_tag, parent_elem):
    """è¦ªè¦ç´ ã‚’æœ€å„ªå…ˆã§åˆ¤å®š"""
    
    # è¦ªãŒSubitem4ã®å ´åˆã€å­ã¯å¿…ãšSubitem5
    if parent_tag == 'Subitem4':
        return 'Subitem5'
    
    # è¦ªãŒSubitem3ã®å ´åˆã€å­ã¯å¿…ãšSubitem4
    if parent_tag == 'Subitem3':
        return 'Subitem4'
    
    # ... ä»¥ä¸‹åŒæ§˜

# ã‚¹ãƒ†ãƒƒãƒ—2: Phase 2.5ã«Subitem5-10ã®å‡¦ç†ã‚’è¿½åŠ 
for level, subitem_type in [
    (7, 'Subitem5'), (8, 'Subitem6'), (9, 'Subitem7'),
    (10, 'Subitem8'), (11, 'Subitem9'), (12, 'Subitem10')
]:
    converted = converter.convert_lists_to_subitems(root, level, subitem_type)
    print(f"  {subitem_type}: {converted}å€‹å¤‰æ›")
```

**æ¤œè¨¼æ–¹æ³•:**
```bash
# å®Ÿè£…å¾Œã€Subitem5ã®æ•°ã‚’ç¢ºèª
python3 convert_list_unified.py test_input5.xml
# æœŸå¾…: Subitem5ãŒ166å€‹ä½œæˆã•ã‚Œã‚‹
```

**æœŸå¾…åŠ¹æœ:**
- Subitem5: 0å€‹ â†’ 166å€‹ (+166)
- ç·å·®åˆ†: 453å€‹ â†’ 287å€‹
- ä¸€è‡´ç‡: 31.5% â†’ ç´„56%

#### èª²é¡Œ1-2: Subitem3ã®éå‰°ä½œæˆã‚’æŠ‘åˆ¶ï¼ˆ+144å€‹ â†’ 0å€‹ï¼‰

**å•é¡Œã®è©³ç´°:**
```
å®Ÿéš›: Subitem2ã€Œï¼ˆï¼‘ï¼‰ã€ â†’ Subitem3ã€Œã‚¢ã€
æœŸå¾…: Subitem2ã€Œï¼ˆï¼‘ï¼‰ã€ â†’ Subitem1ã€Œã‚¢ã€  â† é–“é•ã„ï¼
```
â†’ **62å€‹ã®ã‚±ãƒ¼ã‚¹ã§ç™ºç”Ÿ**

**åŸå› :**
- `determine_element_type()`ãŒæ·±ã•ã‚’å„ªå…ˆã—ã™ãã¦ã„ã‚‹
- Itemã®å­ã‚‚æ·±ã•ãƒ™ãƒ¼ã‚¹ã§åˆ¤å®šã•ã‚Œã€Subitem3ã«ãªã‚‹

**è§£æ±ºç­–:**
```python
def determine_element_type_improved(self, label, parent_tag, parent_elem):
    """ãƒ©ãƒ™ãƒ«ã‚¿ã‚¤ãƒ—ã‚’å„ªå…ˆã—ãŸåˆ¤å®š"""
    
    # è¦ªãŒItemã®å ´åˆ
    if parent_tag == 'Item':
        level = self.get_hierarchy_level(label)
        
        # level 3ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰ â†’ å¿…ãšSubitem1
        if level == 3:
            return 'Subitem1'
        
        # level 4ï¼ˆæ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠï¼‰ â†’ Subitem2
        if level == 4:
            return 'Subitem2'
        
        # level 6ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼‰ â†’ Subitem4
        if level == 6:
            return 'Subitem4'
    
    # è¦ªãŒSubitemã®å ´åˆ
    if parent_tag.startswith('Subitem'):
        parent_level = int(parent_tag.replace('Subitem', ''))
        
        # åŸºæœ¬ã¯è¦ªã®æ¬¡ã®ãƒ¬ãƒ™ãƒ«
        child_level = parent_level + 1
        
        # ãŸã ã—ã€ãƒ©ãƒ™ãƒ«ã‚¿ã‚¤ãƒ—ã§èª¿æ•´
        label_level = self.get_hierarchy_level(label)
        
        # ã‚«ã‚¿ã‚«ãƒŠï¼ˆlevel 3ï¼‰ã®å ´åˆ
        if label_level == 3:
            # è¦ªãŒSubitem1ä»¥ä¸Š â†’ è¦ª+1
            # è¦ªãŒItem â†’ Subitem1
            pass
        
        return f'Subitem{child_level}'
    
    return 'Item'
```

**æœŸå¾…åŠ¹æœ:**
- Subitem3: 241å€‹ â†’ 97å€‹ (-144)
- Subitem1: 53å€‹ â†’ 74å€‹ (+21)
- ç·å·®åˆ†: 287å€‹ â†’ 122å€‹
- ä¸€è‡´ç‡: 56% â†’ ç´„81%

---

### ãƒ•ã‚§ãƒ¼ã‚º2: é«˜å„ªå…ˆåº¦èª²é¡Œï¼ˆP1ï¼‰ - æœŸé–“: 2-3æ—¥

**ç›®æ¨™: ä¸€è‡´ç‡ 81% â†’ 90%ï¼ˆ+72å€‹æ”¹å–„ï¼‰**

#### èª²é¡Œ2-1: Subitem4ä¸è¶³ã®è§£æ¶ˆï¼ˆ-54å€‹ â†’ 0å€‹ï¼‰

**å•é¡Œ:**
- ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆãƒ©ãƒ™ãƒ«ã€Œa, b, cã€ãŒSubitem4ã«ãªã‚‰ãªã„

**è§£æ±ºç­–:**
```python
# get_hierarchy_level()ã§ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚’level 6ã¨æ­£ã—ãåˆ¤å®š
# â†’ æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼ˆå…¨è§’å¯¾å¿œæ¸ˆã¿ï¼‰

# determine_element_type()ã§é©åˆ‡ã«Subitem4ã«å¤‰æ›
if level == 6:  # ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ
    if parent_tag == 'Subitem3':
        return 'Subitem4'
```

#### èª²é¡Œ2-2: Subitem2éå‰°ã®è§£æ¶ˆï¼ˆ+38å€‹ â†’ 0å€‹ï¼‰

**å•é¡Œ:**
- æœ¬æ¥Subitem1ã«ãªã‚‹ã¹ãã‚‚ã®ãŒSubitem2ã«ãªã£ã¦ã„ã‚‹

**è§£æ±ºç­–:**
```python
# Itemã®æœ€åˆã®å­ã¯å¿…ãšSubitem1ã‹ã‚‰é–‹å§‹
if parent_tag == 'Item':
    existing_subitems = parent_elem.findall('.//Subitem1')
    if len(existing_subitems) == 0:
        # ã¾ã Subitem1ãŒãªã„ â†’ å¼·åˆ¶çš„ã«Subitem1
        return 'Subitem1'
```

**æœŸå¾…åŠ¹æœ:**
- Subitem4: 13å€‹ â†’ 67å€‹ (+54)
- Subitem2: 120å€‹ â†’ 82å€‹ (-38)
- ç·å·®åˆ†: 122å€‹ â†’ 30å€‹
- ä¸€è‡´ç‡: 81% â†’ ç´„95%

---

### ãƒ•ã‚§ãƒ¼ã‚º3: ä¸­ãƒ»ä½å„ªå…ˆåº¦èª²é¡Œï¼ˆP2-P3ï¼‰ - æœŸé–“: 1-2æ—¥

**ç›®æ¨™: ä¸€è‡´ç‡ 95% â†’ 98%ä»¥ä¸Šï¼ˆ+30å€‹æ”¹å–„ï¼‰**

#### èª²é¡Œ3-1: Item/Paragraphåˆ¤å®šã®ç²¾ç·»åŒ–

**å•é¡Œ:**
- Item: +21å€‹éå‰°
- Paragraph: -5å€‹ä¸è¶³

**è§£æ±ºç­–:**
```python
# æ•°å­—ãƒ©ãƒ™ãƒ«ï¼ˆlevel 1ï¼‰ã®åˆ¤å®šã‚’æ”¹å–„
if level == 1:  # æ•°å­—ãƒ‘ã‚¿ãƒ¼ãƒ³
    # ParagraphNumãŒå­˜åœ¨ã—ãªã„å ´åˆ
    paragraph_num = paragraph.find('.//ParagraphNum')
    if paragraph_num is None:
        # æ—¢å­˜ã®ItemãŒãªã„ â†’ æ–°ã—ã„Paragraphã¨ã—ã¦åˆ†é›¢
        existing_items = paragraph.findall('.//Item')
        if len(existing_items) == 0:
            return 'Paragraph'
    
    return 'Item'
```

#### èª²é¡Œ3-2: Subitem1ä¸è¶³ã®å¾®èª¿æ•´

**å•é¡Œ:**
- Subitem1: -21å€‹ä¸è¶³

**è§£æ±ºç­–:**
- ãƒ•ã‚§ãƒ¼ã‚º1, 2ã®æ”¹å–„ã§è‡ªå‹•çš„ã«è§£æ¶ˆã•ã‚Œã‚‹è¦‹è¾¼ã¿

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆæœ€å„ªå…ˆï¼‰

- [ ] **1-1-1:** `determine_element_type()`ã«è¦ªãƒ™ãƒ¼ã‚¹åˆ¤å®šã‚’è¿½åŠ 
  - [ ] Subitem4 â†’ Subitem5ã®åˆ¤å®š
  - [ ] Subitem3 â†’ Subitem4ã®åˆ¤å®š
  - [ ] Subitem2 â†’ Subitem3ã®åˆ¤å®š
  - [ ] Subitem1 â†’ Subitem2ã®åˆ¤å®š

- [ ] **1-1-2:** Phase 2.5ã«Subitem5-10ã®å‡¦ç†ã‚’è¿½åŠ 
  - [ ] Phase 2.5-6: Subitem5å¤‰æ›ï¼ˆlevel 7ï¼‰
  - [ ] Phase 2.5-7: Subitem6å¤‰æ›ï¼ˆlevel 8ï¼‰
  - [ ] Phase 2.5-8: Subitem7å¤‰æ›ï¼ˆlevel 9ï¼‰
  - [ ] Phase 2.5-9: Subitem8å¤‰æ›ï¼ˆlevel 10ï¼‰
  - [ ] Phase 2.5-10: Subitem9å¤‰æ›ï¼ˆlevel 11ï¼‰
  - [ ] Phase 2.5-11: Subitem10å¤‰æ›ï¼ˆlevel 12ï¼‰

- [ ] **1-1-3:** å˜ä½“ãƒ†ã‚¹ãƒˆ
  - [ ] Subitem5ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] è¦ªè¦ç´ ãŒSubitem4ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

- [ ] **1-2-1:** `determine_element_type()`ã§Itemã®å­åˆ¤å®šã‚’æ”¹å–„
  - [ ] ã‚«ã‚¿ã‚«ãƒŠ â†’ Subitem1ï¼ˆå›ºå®šï¼‰
  - [ ] æ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠ â†’ Subitem2ï¼ˆå›ºå®šï¼‰

- [ ] **1-2-2:** çµ±åˆãƒ†ã‚¹ãƒˆ
  - [ ] Subitem3ãŒæ¸›å°‘ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] Subitem1ãŒå¢—åŠ ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

- [ ] **1-3:** ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†ç¢ºèª
  - [ ] ä¸€è‡´ç‡ãŒ56%å‰å¾Œã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] ç·å·®åˆ†ãŒ287å€‹å‰å¾Œã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰

- [ ] **2-1:** Subitem4ä¸è¶³ã®è§£æ¶ˆ
  - [ ] ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆåˆ¤å®šã®ç¢ºèª
  - [ ] Subitem3 â†’ Subitem4ã®åˆ¤å®š

- [ ] **2-2:** Subitem2éå‰°ã®è§£æ¶ˆ
  - [ ] Itemã®æœ€åˆã®å­ã‚’Subitem1ã«å›ºå®š

- [ ] **2-3:** ãƒ•ã‚§ãƒ¼ã‚º2å®Œäº†ç¢ºèª
  - [ ] ä¸€è‡´ç‡ãŒ90%å‰å¾Œã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] ç·å·®åˆ†ãŒ30å€‹å‰å¾Œã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### ãƒ•ã‚§ãƒ¼ã‚º3ï¼ˆä¸­ãƒ»ä½å„ªå…ˆåº¦ï¼‰

- [ ] **3-1:** Item/Paragraphåˆ¤å®šã®æ”¹å–„
  - [ ] æ•°å­—ãƒ©ãƒ™ãƒ«ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£

- [ ] **3-2:** æœ€çµ‚ãƒ†ã‚¹ãƒˆ
  - [ ] ä¸€è‡´ç‡ãŒ95%ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] ç·å·®åˆ†ãŒ30å€‹ä»¥ä¸‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ”§ å®Ÿè£…ã®è©³ç´°è¨­è¨ˆ

### è¦ªãƒ™ãƒ¼ã‚¹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ•ã‚§ãƒ¼ã‚º1-1-1ï¼‰

```python
def determine_element_type_with_parent(self, label: str, parent_tag: str, 
                                      parent_elem: ET.Element) -> str:
    """è¦ªè¦ç´ ãƒ™ãƒ¼ã‚¹ã®è¦ç´ ã‚¿ã‚¤ãƒ—åˆ¤å®šï¼ˆæ”¹å–„ç‰ˆï¼‰
    
    åˆ¤å®šã®å„ªå…ˆé †ä½:
    1. è¦ªè¦ç´ ã®ã‚¿ã‚¤ãƒ—ï¼ˆæœ€å„ªå…ˆï¼‰
    2. ãƒ©ãƒ™ãƒ«ã®ã‚¿ã‚¤ãƒ—
    3. ç¾åœ¨ã®æ·±ã•ï¼ˆè£œåŠ©çš„ï¼‰
    
    Args:
        label: ãƒ©ãƒ™ãƒ«æ–‡å­—åˆ—
        parent_tag: è¦ªè¦ç´ ã®ã‚¿ã‚°å
        parent_elem: è¦ªè¦ç´ 
    
    Returns:
        str: è¦ç´ ã‚¿ã‚¤ãƒ—ï¼ˆ'Item', 'Subitem1', ... 'Subitem10'ï¼‰
    """
    
    # ===== å„ªå…ˆåº¦1: è¦ªè¦ç´ ãƒ™ãƒ¼ã‚¹ã®åˆ¤å®š =====
    
    # Subitemã®å­ã¯å¿…ãšè¦ª+1ã®Subitem
    if parent_tag.startswith('Subitem'):
        parent_level = int(parent_tag.replace('Subitem', ''))
        child_level = parent_level + 1
        
        # Subitem10ã‚’è¶…ãˆãªã„
        if child_level <= 10:
            return f'Subitem{child_level}'
        else:
            # Subitem10ã®å­ã‚‚Subitem10ï¼ˆæœ€å¤§æ·±åº¦ï¼‰
            return 'Subitem10'
    
    # ===== å„ªå…ˆåº¦2: ãƒ©ãƒ™ãƒ«ã‚¿ã‚¤ãƒ—ãƒ™ãƒ¼ã‚¹ã®åˆ¤å®š =====
    
    level = self.get_hierarchy_level(label)
    
    # Itemã®å­ã®å ´åˆ
    if parent_tag == 'Item':
        # level 3ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰ â†’ Subitem1
        if level == 3:
            return 'Subitem1'
        
        # level 4ï¼ˆæ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠï¼‰ â†’ Subitem2
        if level == 4:
            # ãŸã ã—ã€æ—¢ã«Subitem1ãŒãªã„å ´åˆã¯Subitem1ã‹ã‚‰é–‹å§‹
            existing_subitem1 = parent_elem.findall('.//Subitem1')
            if len(existing_subitem1) == 0:
                return 'Subitem1'
            return 'Subitem2'
        
        # level 5ï¼ˆäºŒé‡æ‹¬å¼§ã‚«ã‚¿ã‚«ãƒŠï¼‰ â†’ Subitem3
        if level == 5:
            return 'Subitem3'
        
        # level 6ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼‰ â†’ Subitem4
        if level == 6:
            return 'Subitem4'
        
        # ãã®ä»– â†’ Subitem1ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
        return 'Subitem1'
    
    # Paragraphã®å­ã®å ´åˆ
    if parent_tag == 'Paragraph':
        # level 1ï¼ˆæ•°å­—ï¼‰ â†’ Item
        if level == 1:
            return 'Item'
        
        # level 2ï¼ˆæ‹¬å¼§æ•°å­—ï¼‰ â†’ Item
        if level == 2:
            return 'Item'
        
        # ãã®ä»– â†’ Itemï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
        return 'Item'
    
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    return 'Item'
```

### Subitem5-10ã®å‡¦ç†è¿½åŠ ï¼ˆãƒ•ã‚§ãƒ¼ã‚º1-1-2ï¼‰

```python
# ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆprocess_xml_fileå†…ï¼‰

# Phase 2.5-6: Subitem5å¤‰æ›ï¼ˆlevel 7ï¼‰
print("\n  ã€Phase 2.5-6: Subitem5è¦ç´ ã®è¿½åŠ ä½œæˆï¼ˆlevel 7ï¼‰ã€‘")
level7_before = converter.count_lists_by_level(root, 7)
subitem5_before = len(root.findall('.//Subitem5'))

# è¦ªãƒ™ãƒ¼ã‚¹åˆ¤å®šã‚’ä½¿ç”¨ã—ãŸå¤‰æ›
converted_subitem5 = converter.convert_lists_to_subitems_with_parent(
    root, 'Subitem4', 'Subitem5'
)

subitem5_after = len(root.findall('.//Subitem5'))
remaining_after_subitem5 = converter.count_remaining_lists(root)

print(f"    - å¤‰æ›å‰: Subitem5 {subitem5_before}å€‹")
print(f"    - å¤‰æ›å¾Œ: Subitem5 {subitem5_after}å€‹ (+{subitem5_after - subitem5_before})")
print(f"    - å¤‰æ›æ•°: {converted_subitem5}å€‹")
print(f"    - æ®‹ã‚Šã®List: {remaining_after_subitem5}å€‹")

# Phase 2.5-7: Subitem6å¤‰æ›ï¼ˆlevel 8ï¼‰
# ... åŒæ§˜ã«å®Ÿè£…
```

### æ–°ã—ã„å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰

```python
def convert_lists_to_subitems_with_parent(self, root: ET.Element, 
                                         parent_tag: str, 
                                         subitem_type: str) -> int:
    """è¦ªè¦ç´ ãƒ™ãƒ¼ã‚¹ã®Subitemå¤‰æ›ï¼ˆæ”¹å–„ç‰ˆï¼‰
    
    æŒ‡å®šã•ã‚ŒãŸè¦ªè¦ç´ ã®ä¸­ã®Listè¦ç´ ã‚’Subitemã«å¤‰æ›ã—ã¾ã™ã€‚
    ãƒ©ãƒ™ãƒ«ã®ãƒ¬ãƒ™ãƒ«ã§ã¯ãªãã€è¦ªè¦ç´ ã®ã‚¿ã‚¤ãƒ—ã§åˆ¤å®šã—ã¾ã™ã€‚
    
    Args:
        root: ãƒ«ãƒ¼ãƒˆè¦ç´ 
        parent_tag: è¦ªè¦ç´ ã®ã‚¿ã‚°åï¼ˆä¾‹: 'Subitem4'ï¼‰
        subitem_type: å¤‰æ›å…ˆã®Subitemã‚¿ã‚¤ãƒ—ï¼ˆä¾‹: 'Subitem5'ï¼‰
    
    Returns:
        int: å¤‰æ›ã—ãŸè¦ç´ æ•°
    """
    converted = 0
    
    # æŒ‡å®šã•ã‚ŒãŸè¦ªè¦ç´ ã‚’å…¨ã¦æ¢ã™
    for parent_elem in root.findall(f'.//{parent_tag}'):
        subitem_counter = len(parent_elem.findall(f'.//{subitem_type}')) + 1
        
        # è¦ªè¦ç´ å†…ã®Listè¦ç´ ã‚’åé›†
        lists_to_convert = []
        for list_elem in parent_elem.findall('.//List'):
            # æ—¢ã«ä»–ã®Subitemå†…ã«ã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
            is_nested = False
            for ancestor in parent_elem.findall('.//Subitem1 | .//Subitem2 | .//Subitem3 | .//Subitem4 | .//Subitem5'):
                if ancestor != parent_elem and list_elem in list(ancestor.iter()):
                    is_nested = True
                    break
            
            if is_nested:
                continue
            
            columns = self.extract_columns(list_elem)
            if columns and len(columns) >= 2:
                label = columns[0][0]
                lists_to_convert.append((list_elem, label, columns))
        
        # å¤‰æ›å®Ÿè¡Œ
        for list_elem, label, columns in lists_to_convert:
            content_elem = columns[1][1] if len(columns) > 1 else None
            
            # Subitemè¦ç´ ã‚’ä½œæˆ
            subitem = self.create_subitem_element(subitem_type, label, content_elem, subitem_counter)
            
            # æŒ¿å…¥ä½ç½®ã‚’å–å¾—
            all_children = list(parent_elem)
            if list_elem in all_children:
                insert_position = all_children.index(list_elem)
                
                # Listã‚’å‰Šé™¤
                parent_elem.remove(list_elem)
                
                # Subitemã‚’æŒ¿å…¥
                parent_elem.insert(insert_position, subitem)
                
                subitem_counter += 1
                converted += 1
    
    return converted
```

---

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ

### æ•°å€¤ç›®æ¨™ã®æ¨ç§»

```
ç¾åœ¨:
  ä¸€è‡´ç‡: 31.5%
  ç·å·®åˆ†: 453å€‹
  
  â†“ ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†ï¼ˆ1æ—¥ï¼‰
  
ãƒ•ã‚§ãƒ¼ã‚º1å¾Œ:
  ä¸€è‡´ç‡: 56%
  ç·å·®åˆ†: 287å€‹
  æ”¹å–„: +166å€‹ï¼ˆSubitem5ä½œæˆï¼‰+ 144å€‹ï¼ˆSubitem3ä¿®æ­£ï¼‰
  
  â†“ ãƒ•ã‚§ãƒ¼ã‚º2å®Œäº†ï¼ˆ2-3æ—¥ï¼‰
  
ãƒ•ã‚§ãƒ¼ã‚º2å¾Œ:
  ä¸€è‡´ç‡: 90%
  ç·å·®åˆ†: 30å€‹
  æ”¹å–„: +54å€‹ï¼ˆSubitem4ï¼‰+ 38å€‹ï¼ˆSubitem2ï¼‰
  
  â†“ ãƒ•ã‚§ãƒ¼ã‚º3å®Œäº†ï¼ˆ1-2æ—¥ï¼‰
  
ãƒ•ã‚§ãƒ¼ã‚º3å¾Œ:
  ä¸€è‡´ç‡: 95%ä»¥ä¸Š
  ç·å·®åˆ†: <20å€‹
  æ”¹å–„: æ®‹ã‚Šã®å¾®èª¿æ•´
```

### å·¥æ•°è¦‹ç©ã‚‚ã‚Š

| ãƒ•ã‚§ãƒ¼ã‚º | å®Ÿè£…å·¥æ•° | ãƒ†ã‚¹ãƒˆå·¥æ•° | åˆè¨ˆ |
|---------|----------|-----------|------|
| ãƒ•ã‚§ãƒ¼ã‚º1 | 4æ™‚é–“ | 2æ™‚é–“ | 6æ™‚é–“ï¼ˆ1æ—¥ï¼‰ |
| ãƒ•ã‚§ãƒ¼ã‚º2 | 6æ™‚é–“ | 4æ™‚é–“ | 10æ™‚é–“ï¼ˆ2æ—¥ï¼‰ |
| ãƒ•ã‚§ãƒ¼ã‚º3 | 4æ™‚é–“ | 2æ™‚é–“ | 6æ™‚é–“ï¼ˆ1æ—¥ï¼‰ |
| **åˆè¨ˆ** | **14æ™‚é–“** | **8æ™‚é–“** | **22æ™‚é–“ï¼ˆ4æ—¥ï¼‰** |

---

## ğŸ¯ æˆåŠŸåŸºæº–

### ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†åŸºæº–
- âœ… Subitem5ãŒä½œæˆã•ã‚Œã‚‹ï¼ˆ0å€‹ â†’ 166å€‹ï¼‰
- âœ… Subitem3ãŒæ¸›å°‘ã™ã‚‹ï¼ˆ241å€‹ â†’ 150å€‹ä»¥ä¸‹ï¼‰
- âœ… ä¸€è‡´ç‡ãŒ50%ä»¥ä¸Š
- âœ… å˜ä½“ãƒ†ã‚¹ãƒˆãŒå…¨ã¦ãƒ‘ã‚¹

### ãƒ•ã‚§ãƒ¼ã‚º2å®Œäº†åŸºæº–
- âœ… Subitem4ãŒä½œæˆã•ã‚Œã‚‹ï¼ˆ13å€‹ â†’ 60å€‹ä»¥ä¸Šï¼‰
- âœ… Subitem2ãŒé©æ­£åŒ–ã•ã‚Œã‚‹ï¼ˆ120å€‹ â†’ 90å€‹ä»¥ä¸‹ï¼‰
- âœ… ä¸€è‡´ç‡ãŒ85%ä»¥ä¸Š
- âœ… çµ±åˆãƒ†ã‚¹ãƒˆãŒå…¨ã¦ãƒ‘ã‚¹

### ãƒ•ã‚§ãƒ¼ã‚º3å®Œäº†åŸºæº–
- âœ… å…¨è¦ç´ ã®å·®åˆ†ãŒÂ±10ä»¥å†…
- âœ… ä¸€è‡´ç‡ãŒ95%ä»¥ä¸Š
- âœ… test_input5.xmlã§æœŸå¾…é€šã‚Šã®å‡ºåŠ›

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `ç²¾åº¦å‘ä¸Šã®ãŸã‚ã®æ”¹å–„ææ¡ˆ.md` - è©³ç´°ãªå•é¡Œåˆ†æ
- `Phase2å®Œå…¨å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆ.md` - ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³
- `convert_list_unified.py` - å®Ÿè£…ã‚³ãƒ¼ãƒ‰

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥  
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ãƒ•ã‚§ãƒ¼ã‚º1ã®å®Ÿè£…é–‹å§‹  
**æ‹…å½“**: AI Assistant  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å¿…è¦

