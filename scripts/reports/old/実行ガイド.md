# convert_list_unified.py å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥

---

## ğŸ“‹ ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

### âœ… å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½

1. **Phase 0: Articleè¦ç´ ã®åˆ†å‰²** âœ…
   - ã€Œç¬¬â—‹ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã§Articleã‚’è‡ªå‹•åˆ†å‰²

2. **Phase 0.5: ãƒ©ãƒ™ãƒ«åˆ†é›¢æ©Ÿèƒ½ï¼ˆåŸºç›¤é–¢æ•°ï¼‰** âœ…
   - `split_label_and_text()` ãƒ¡ã‚½ãƒƒãƒ‰
   - **æ³¨æ„**: ã¾ã å®Ÿéš›ã®å¤‰æ›å‡¦ç†ã«ã¯çµ±åˆã•ã‚Œã¦ã„ã¾ã›ã‚“

3. **Phase 1: éšå±¤åˆ¤å®šæ©Ÿèƒ½ï¼ˆåŸºç›¤é–¢æ•°ï¼‰** âœ…
   - `get_hierarchy_level()` ãƒ¡ã‚½ãƒƒãƒ‰
   - `needs_intermediate_element()` ãƒ¡ã‚½ãƒƒãƒ‰
   - **æ³¨æ„**: ã¾ã å®Ÿéš›ã®å¤‰æ›å‡¦ç†ã«ã¯çµ±åˆã•ã‚Œã¦ã„ã¾ã›ã‚“

4. **æ—¢å­˜ã®å¤‰æ›æ©Ÿèƒ½**
   - ç§‘ç›®æ§‹é€ å¤‰æ›ï¼ˆã€”ç§‘ç›®åã€•ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
   - Paragraphæ§‹é€ å¤‰æ›ï¼ˆList+Columnï¼‰
   - Article NumæŒ¯ã‚Šç›´ã—

---

## ğŸš€ åŸºæœ¬çš„ãªå®Ÿè¡Œæ–¹æ³•

### 1. ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ

```bash
cd /Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script

# åŸºæœ¬å½¢å¼
python3 convert_list_unified.py <å…¥åŠ›XMLãƒ•ã‚¡ã‚¤ãƒ«> [å‡ºåŠ›XMLãƒ•ã‚¡ã‚¤ãƒ«]

# ä¾‹1: å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®š
python3 convert_list_unified.py test_input5.xml test_output5_converted.xml

# ä¾‹2: å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’çœç•¥ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
python3 convert_list_unified.py test_input5.xml
# â†’ test_input5_converted.xml ãŒç”Ÿæˆã•ã‚Œã‚‹
```

### 2. å®Ÿè¡Œçµæœã®è¡¨ç¤º

å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®çµ±è¨ˆæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«: test_input5.xml
å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«: test_output5_converted.xml

Phase 0: Articleè¦ç´ ã®åˆ†å‰²...
  â†’ 1å€‹ã®Articleã‚’åˆ†å‰²ã—ã¾ã—ãŸ
Phase 1: ç§‘ç›®æ§‹é€ ã®å¤‰æ›...
Phase 2: Paragraphæ§‹é€ ã®å¤‰æ›...
Phase 3: Article NumæŒ¯ã‚Šç›´ã—...
  â†’ 13å€‹ã®Article Numã‚’æŒ¯ã‚Šç›´ã—ã¾ã—ãŸ
Phase 4: Paragraphç•ªå·ã®å†æ¡ç•ª...
Phase 5: XMLæ•´å½¢...

å¤‰æ›å®Œäº†ï¼

å‡¦ç†çµ±è¨ˆ:
  Articleåˆ†å‰²æ•°: 1
  ç§‘ç›®æ§‹é€ ã®å¤‰æ›æ•°: 7
  Paragraphæ§‹é€ ã®å¤‰æ›æ•°: 12
  ä½œæˆã•ã‚ŒãŸItemè¦ç´ : 7
  ä½œæˆã•ã‚ŒãŸParagraphè¦ç´ : 18
  Article NumæŒ¯ã‚Šç›´ã—æ•°: 13
```

---

## ğŸ”§ æ–°è¦å®Ÿè£…æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

### ãƒ©ãƒ™ãƒ«åˆ†é›¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ

ä»Šå›å®Ÿè£…ã—ãŸ`split_label_and_text()`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€**åŸºç›¤é–¢æ•°**ã¨ã—ã¦è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
å®Ÿéš›ã®å¤‰æ›å‡¦ç†ã¸ã®çµ±åˆã¯ã¾ã è¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œç¢ºèªã§ãã¾ã™ã€‚

```bash
cd /Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script

# ãƒ©ãƒ™ãƒ«åˆ†é›¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python3 test_split_label.py
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**
```
================================================================================
ãƒ©ãƒ™ãƒ«åˆ†é›¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
================================================================================

ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 1: âœ… PASS
  å…¥åŠ›:     ã€Œï¼ˆã‚¦ï¼‰ã€€ä¸»ã¨ã—ã¦å°‚é–€å­¦ç§‘ã«ãŠã„ã¦é–‹è¨­ã•ã‚Œã‚‹å„æ•™ç§‘ãƒ»ç§‘ç›®ã€
  æœŸå¾…å€¤:   ãƒ©ãƒ™ãƒ«=ã€Œï¼ˆã‚¦ï¼‰ã€, ãƒ†ã‚­ã‚¹ãƒˆ=ã€Œä¸»ã¨ã—ã¦å°‚é–€å­¦ç§‘ã«ãŠã„ã¦é–‹è¨­ã•ã‚Œã‚‹å„æ•™ç§‘ãƒ»ç§‘ç›®ã€
  å®Ÿéš›å€¤:   ãƒ©ãƒ™ãƒ«=ã€Œï¼ˆã‚¦ï¼‰ã€, ãƒ†ã‚­ã‚¹ãƒˆ=ã€Œä¸»ã¨ã—ã¦å°‚é–€å­¦ç§‘ã«ãŠã„ã¦é–‹è¨­ã•ã‚Œã‚‹å„æ•™ç§‘ãƒ»ç§‘ç›®ã€

ï¼ˆ... å…¨11å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ ...ï¼‰

================================================================================
ãƒ†ã‚¹ãƒˆçµæœ: 11å€‹æˆåŠŸ, 0å€‹å¤±æ•—
================================================================================
```

---

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

### 1. æ–°æ©Ÿèƒ½ã®ä½ç½®ã¥ã‘

ä»Šå›å®Ÿè£…ã—ãŸä»¥ä¸‹ã®æ©Ÿèƒ½ã¯**åŸºç›¤é–¢æ•°**ã¨ã—ã¦è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼š

- âœ… `split_label_and_text()` - ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆã®åˆ†é›¢
- âœ… `get_hierarchy_level()` - éšå±¤ãƒ¬ãƒ™ãƒ«ã®åˆ¤å®š
- âœ… `needs_intermediate_element()` - ä¸­é–“è¦ç´ ã®å¿…è¦æ€§åˆ¤å®š

**ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯ã€ã¾ã å®Ÿéš›ã®å¤‰æ›å‡¦ç†ã«ã¯çµ±åˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚**

### 2. ç¾åœ¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‹•ä½œ

`convert_list_unified.py`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€**æ—¢å­˜ã®å¤‰æ›æ©Ÿèƒ½**ã®ã¿ãŒå‹•ä½œã—ã¾ã™ï¼š

| æ©Ÿèƒ½ | å®Ÿè£…çŠ¶æ³ | å‹•ä½œ |
|------|---------|------|
| Articleåˆ†å‰²ï¼ˆPhase 0ï¼‰ | âœ… å®Œäº†ãƒ»çµ±åˆæ¸ˆã¿ | å®Ÿè¡Œã•ã‚Œã‚‹ |
| ãƒ©ãƒ™ãƒ«åˆ†é›¢ï¼ˆPhase 0.5ï¼‰ | âœ… å®Œäº†ãƒ»**æœªçµ±åˆ** | **å®Ÿè¡Œã•ã‚Œãªã„** |
| éšå±¤åˆ¤å®šï¼ˆPhase 1ï¼‰ | âœ… å®Œäº†ãƒ»**æœªçµ±åˆ** | **å®Ÿè¡Œã•ã‚Œãªã„** |
| ç§‘ç›®æ§‹é€ å¤‰æ›ï¼ˆæ—¢å­˜ï¼‰ | âœ… æ—¢å­˜æ©Ÿèƒ½ | å®Ÿè¡Œã•ã‚Œã‚‹ |
| Paragraphæ§‹é€ å¤‰æ›ï¼ˆæ—¢å­˜ï¼‰ | âœ… æ—¢å­˜æ©Ÿèƒ½ | å®Ÿè¡Œã•ã‚Œã‚‹ |
| Article NumæŒ¯ã‚Šç›´ã—ï¼ˆæ—¢å­˜ï¼‰ | âœ… æ—¢å­˜æ©Ÿèƒ½ | å®Ÿè¡Œã•ã‚Œã‚‹ |

### 3. ãªãœçµ±åˆã•ã‚Œã¦ã„ãªã„ã®ã‹ï¼Ÿ

**æ®µéšçš„å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ï¼š

1. **Phase 0.5**: åŸºç›¤é–¢æ•°ã®å®Ÿè£… â† **å®Œäº†**
2. **Phase 2**: å®Ÿéš›ã®å¤‰æ›å‡¦ç†ã¸ã®çµ±åˆ â† **æœªå®Ÿæ–½**

ã“ã®æ–¹å¼ã«ã‚ˆã‚Šï¼š
- âœ… å„æ©Ÿèƒ½ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
- âœ… æ—¢å­˜æ©Ÿèƒ½ã‚’å£Šã™ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–
- âœ… æ®µéšçš„ãªå“è³ªä¿è¨¼ãŒå¯èƒ½

---

## ğŸ¯ æ–°æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ãŸå¤‰æ›ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: Phase 2ã®å®Ÿè£…ã‚’å¾…ã¤ï¼ˆæ¨å¥¨ï¼‰

**Phase 2: è¤‡é›‘ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…**ã§ã€ä»¥ä¸‹ã‚’çµ±åˆäºˆå®šï¼š

1. `split_label_and_text()`ã‚’`convert_paragraph_structure()`ã«çµ±åˆ
2. Columnæ§‹é€ ãªã—Listè¦ç´ ã®å‡¦ç†æ‹¡å¼µ
3. ParagraphSentenceå†…ã®ãƒ©ãƒ™ãƒ«+ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†

**å®Ÿè£…æ™‚é–“**: 3-4æ—¥

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: æ‰‹å‹•ã§çµ±åˆã™ã‚‹

`convert_paragraph_structure()`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã«ä»¥ä¸‹ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ï¼š

```python
def convert_paragraph_structure(self, paragraph: ET.Element) -> List[ET.Element]:
    """Paragraphæ§‹é€ ã®å¤‰æ›ï¼ˆæ‹¡å¼µç‰ˆï¼‰"""
    
    # ... æ—¢å­˜ã®å‡¦ç† ...
    
    # Columnæ§‹é€ ãªã—Listã®å‡¦ç†
    for list_elem in non_column_lists:
        sentence = list_elem.find('.//Sentence')
        if sentence is not None:
            text = ''.join(sentence.itertext()).strip()
            
            # â˜… æ–°æ©Ÿèƒ½: ãƒ©ãƒ™ãƒ«åˆ†é›¢
            label, remaining_text = self.split_label_and_text(text)
            
            if label is not None:
                # â˜… æ–°æ©Ÿèƒ½: éšå±¤åˆ¤å®š
                level = self.get_hierarchy_level(label)
                
                # Item/Subitemè¦ç´ ã«å¤‰æ›
                # ... å¤‰æ›å‡¦ç† ...
```

---

## ğŸ“Š å®Ÿè¡Œä¾‹

### ä¾‹1: test_input5.xmlã®å¤‰æ›

```bash
cd /Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script

# å¤‰æ›å®Ÿè¡Œ
python3 convert_list_unified.py test_input5.xml test_output5_new.xml

# çµæœç¢ºèª
ls -lh test_output5_new.xml
```

### ä¾‹2: ä»–ã®XMLãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›

```bash
# çµ¶å¯¾ãƒ‘ã‚¹ã§ã‚‚æŒ‡å®šå¯èƒ½
python3 convert_list_unified.py \
  /Users/fukushima/Documents/xml_anken/gyosei-xml/xml_data/0/some_file.xml \
  /Users/fukushima/Documents/xml_anken/gyosei-xml/fixed_xml/some_file_fixed.xml
```

### ä¾‹3: ã‚¨ãƒ©ãƒ¼å‡¦ç†

```bash
# å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆ
python3 convert_list_unified.py not_exist.xml
# â†’ ã‚¨ãƒ©ãƒ¼: å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: not_exist.xml

# å¼•æ•°ãªã—ã§å®Ÿè¡Œã—ãŸå ´åˆ
python3 convert_list_unified.py
# â†’ ä½¿ç”¨æ³•: python convert_list_unified.py <input_xml_file> [output_xml_file]
```

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›

ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã®`print`æ–‡ã§å‡¦ç†çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚

è¿½åŠ ã®ãƒ‡ãƒãƒƒã‚°æƒ…å ±ãŒå¿…è¦ãªå ´åˆã¯ã€ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```python
# convert_list_unified.py ã®é©åˆ‡ãªç®‡æ‰€ã«è¿½åŠ 
print(f"DEBUG: ãƒ©ãƒ™ãƒ«åˆ†é›¢çµæœ: label={label}, text={text}")
```

### ä¸­é–“çµæœã®ç¢ºèª

å„Phaseã®å‡¦ç†å¾Œã«ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ï¼š

```python
# Phase 1ã®å¾Œ
tree.write('debug_after_phase1.xml', encoding='utf-8', xml_declaration=True)

# Phase 2ã®å¾Œ
tree.write('debug_after_phase2.xml', encoding='utf-8', xml_declaration=True)
```

---

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1: å®Ÿè¡Œã—ã¦ã‚‚ãƒ©ãƒ™ãƒ«åˆ†é›¢ãŒè¡Œã‚ã‚Œãªã„

**A**: ç¾åœ¨ã€`split_label_and_text()`ã¯åŸºç›¤é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã•ã‚ŒãŸã ã‘ã§ã€å®Ÿéš›ã®å¤‰æ›å‡¦ç†ã«ã¯çµ±åˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Phase 2ã®å®Ÿè£…ãŒå¿…è¦ã§ã™ã€‚

### Q2: Python 3.9ä»¥é™ãŒå¿…è¦ã¨è¡¨ç¤ºã•ã‚Œã‚‹

**A**: XMLæ•´å½¢æ©Ÿèƒ½ï¼ˆ`ET.indent()`ï¼‰ã«Python 3.9ä»¥é™ãŒå¿…è¦ã§ã™ã€‚

```bash
# Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
python3 --version

# Python 3.9æœªæº€ã®å ´åˆã¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
# ã¾ãŸã¯æ•´å½¢æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
```

### Q3: ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

**A**: å…¥åŠ›XMLãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```bash
# ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç¢ºèª
file -I test_input5.xml

# UTF-8ã«å¤‰æ›ï¼ˆå¿…è¦ãªå ´åˆï¼‰
iconv -f SHIFT-JIS -t UTF-8 input.xml > input_utf8.xml
```

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ã™ãã«å®Ÿè¡Œå¯èƒ½ãªã“ã¨

1. âœ… æ—¢å­˜æ©Ÿèƒ½ã§ã®å¤‰æ›å®Ÿè¡Œ
   ```bash
   python3 convert_list_unified.py test_input5.xml test_output5_converted.xml
   ```

2. âœ… ãƒ©ãƒ™ãƒ«åˆ†é›¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
   ```bash
   python3 test_split_label.py
   ```

3. âœ… å¤‰æ›çµæœã®ç¢ºèª
   ```bash
   # è¦ç´ æ•°ã‚«ã‚¦ãƒ³ãƒˆ
   grep -o "<Article" test_output5_converted.xml | wc -l
   grep -o "<Item" test_output5_converted.xml | wc -l
   ```

### Phase 2å®Ÿè£…å¾Œã«å¯èƒ½ã«ãªã‚‹ã“ã¨

1. â³ Columnæ§‹é€ ãªã—Listè¦ç´ ã®è‡ªå‹•å¤‰æ›
2. â³ ParagraphSentenceå†…ã®ãƒ©ãƒ™ãƒ«+ãƒ†ã‚­ã‚¹ãƒˆã®è‡ªå‹•åˆ†é›¢
3. â³ è¤‡é›‘ãªéšå±¤ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡¦ç†ï¼ˆç©ºè¦ç´ æŒ¿å…¥ï¼‰

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `ä¿®æ­£ãƒ­ã‚¸ãƒƒã‚¯åˆ†æ.md` - å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã®è©³ç´°
- `å®Ÿè£…æˆ¦ç•¥åˆ†æ.md` - å®Ÿè£…è¨ˆç”»ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
- `ãƒ©ãƒ™ãƒ«åˆ†é›¢å®Ÿè£…ã‚µãƒãƒªãƒ¼.md` - Phase 0.5ã®å®Ÿè£…è©³ç´°
- `test_split_label.py` - ãƒ©ãƒ™ãƒ«åˆ†é›¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥  
**ãƒ•ã‚¡ã‚¤ãƒ«**: `/Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script/å®Ÿè¡Œã‚¬ã‚¤ãƒ‰.md`

