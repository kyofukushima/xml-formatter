# è¦ªã‚¿ã‚°ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã®æ”¹å–„æ¡ˆ

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥

---

## ğŸ¯ ç¾åœ¨ã®å•é¡Œ

### èª¤ã£ãŸå‹•ä½œ
```
ã‚¢ (ãƒ¬ãƒ™ãƒ«3)  â†’ è¦ª: Item, è¦ç´ ã‚¿ã‚¤ãƒ—: Subitem1  âœ…
  ï¼ˆã‚¢ï¼‰(ãƒ¬ãƒ™ãƒ«4) â†’ è¦ª: Subitem1, è¦ç´ ã‚¿ã‚¤ãƒ—: Subitem2 âœ…
  ï¼ˆã‚¤ï¼‰(ãƒ¬ãƒ™ãƒ«4) â†’ è¦ª: Paragraph, è¦ç´ ã‚¿ã‚¤ãƒ—: Subitem2 âŒ â† åŒã˜ãƒ¬ãƒ™ãƒ«ãªã®ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹
```

### ã‚ã‚‹ã¹ãå‹•ä½œ
```
ã‚¢ (ãƒ¬ãƒ™ãƒ«3)  â†’ è¦ª: Item, è¦ç´ ã‚¿ã‚¤ãƒ—: Subitem1  âœ…
  ï¼ˆã‚¢ï¼‰(ãƒ¬ãƒ™ãƒ«4) â†’ è¦ª: Subitem1, è¦ç´ ã‚¿ã‚¤ãƒ—: Subitem2 âœ…
  ï¼ˆã‚¤ï¼‰(ãƒ¬ãƒ™ãƒ«4) â†’ è¦ª: Subitem1, è¦ç´ ã‚¿ã‚¤ãƒ—: Subitem2 âœ… â† å…„å¼Ÿè¦ç´ ã¨ã—ã¦åŒã˜è¦ªã®ä¸‹ã«
```

---

## ğŸ” æ ¹æœ¬åŸå› 

ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼š
```python
# å‰ã®ãƒ¬ãƒ™ãƒ«ã¨åŒã˜ã‹æµ…ã„å ´åˆ â†’ è¦ªã‚¿ã‚°ã‚’Paragraphã«ãƒªã‚»ãƒƒãƒˆ
if previous_level > 0 and level <= previous_level:
    actual_parent_tag = 'Paragraph'  # âŒ å¸¸ã«Paragraphã«æˆ»ã—ã¦ã—ã¾ã†
```

**å•é¡Œ**: åŒã˜ãƒ¬ãƒ™ãƒ«ã®è¦ç´ ãŒé€£ç¶šã™ã‚‹å ´åˆã€å…¨ã¦Paragraphç›´ä¸‹ã¨ã—ã¦å‡¦ç†ã•ã‚Œã¦ã—ã¾ã†

---

## âœ… è§£æ±ºç­–

### éšå±¤ã‚¹ã‚¿ãƒƒã‚¯ã®å°å…¥

è¦ªè¦ç´ ã‚’**ã‚¹ã‚¿ãƒƒã‚¯**ã§ç®¡ç†ã—ã€ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦é©åˆ‡ãªè¦ªã‚’å–å¾—ï¼š

```python
# éšå±¤ã‚¹ã‚¿ãƒƒã‚¯ã®å®šç¾©
hierarchy_stack = [
    {'level': 0, 'tag': 'Paragraph', 'element': current_paragraph}
]

# æ–°ã—ã„è¦ç´ ã‚’ä½œæˆã™ã‚‹éš›ï¼š
# 1. ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ã«å¯¾å¿œã™ã‚‹è¦ªã‚’æ¢ã™ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ã‚’é¡ã‚‹ï¼‰
# 2. æ–°ã—ã„è¦ç´ ã‚’ã‚¹ã‚¿ãƒƒã‚¯ã«ãƒ—ãƒƒã‚·ãƒ¥
# 3. ã‚ˆã‚Šæµ…ã„ãƒ¬ãƒ™ãƒ«ã®è¦ç´ ãŒæ¥ãŸã‚‰ã€ã‚¹ã‚¿ãƒƒã‚¯ã‚’ãƒãƒƒãƒ—
```

### å…·ä½“çš„ãªå®Ÿè£…ä¾‹

```python
# ãƒ¬ãƒ™ãƒ«2-6ã®å‡¦ç†
elif level >= 2:
    previous_level = hierarchy_context.get('previous_level', 0)
    
    # ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰é©åˆ‡ãªè¦ªã‚’è¦‹ã¤ã‘ã‚‹
    parent_level = level - 1  # 1ã¤ä¸Šã®ãƒ¬ãƒ™ãƒ«ã‚’æ¢ã™
    
    # ã‚¹ã‚¿ãƒƒã‚¯ã‚’é¡ã£ã¦ã€parent_levelä»¥ä¸‹ã®è¦ç´ ã‚’æ¢ã™
    actual_parent = None
    actual_parent_tag = 'Paragraph'
    
    # hierarchy_stackã‚’é€†é †ã«æ¢ç´¢
    for item in reversed(hierarchy_stack):
        if item['level'] < level:
            actual_parent = item['element']
            actual_parent_tag = item['tag']
            break
    
    # è¦ç´ ã‚¿ã‚¤ãƒ—ã‚’æ±ºå®š
    element_type = self.determine_element_type(label, actual_parent_tag)
    
    # æ–°ã—ã„è¦ç´ ã‚’ä½œæˆ
    new_elem = create_element(element_type, label, content_elem, counter)
    
    # ã‚¹ã‚¿ãƒƒã‚¯ã‚’æ›´æ–°
    # ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ä»¥ä¸Šã®è¦ç´ ã‚’ãƒãƒƒãƒ—
    while hierarchy_stack and hierarchy_stack[-1]['level'] >= level:
        hierarchy_stack.pop()
    
    # æ–°ã—ã„è¦ç´ ã‚’ã‚¹ã‚¿ãƒƒã‚¯ã«ãƒ—ãƒƒã‚·ãƒ¥
    hierarchy_stack.append({
        'level': level,
        'tag': element_type,
        'element': new_elem
    })
    
    # è¦ªè¦ç´ ã«è¿½åŠ 
    if actual_parent is not None:
        actual_parent.append(new_elem)
```

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ

### ã‚±ãƒ¼ã‚¹1: æ·±ããªã‚‹å ´åˆ
```
ï¼ˆï¼‘ï¼‰(ãƒ¬ãƒ™ãƒ«2) â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2)]
  ã‚¢(ãƒ¬ãƒ™ãƒ«3)  â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2), Subitem1(3)]
    ï¼ˆã‚¢ï¼‰(ãƒ¬ãƒ™ãƒ«4) â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2), Subitem1(3), Subitem2(4)]
```

### ã‚±ãƒ¼ã‚¹2: åŒã˜ãƒ¬ãƒ™ãƒ«ãŒç¶šãå ´åˆ
```
ï¼ˆï¼‘ï¼‰(ãƒ¬ãƒ™ãƒ«2) â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2)]
ï¼ˆï¼’ï¼‰(ãƒ¬ãƒ™ãƒ«2) â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2)]  â† ãƒ¬ãƒ™ãƒ«2ä»¥ä¸Šã‚’ãƒãƒƒãƒ—ã—ã¦å†ãƒ—ãƒƒã‚·ãƒ¥
ï¼ˆï¼“ï¼‰(ãƒ¬ãƒ™ãƒ«2) â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2)]
```

### ã‚±ãƒ¼ã‚¹3: æµ…ããªã‚‹å ´åˆ
```
    ï¼ˆã‚¢ï¼‰(ãƒ¬ãƒ™ãƒ«4) â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2), Subitem1(3), Subitem2(4)]
  ã‚¤(ãƒ¬ãƒ™ãƒ«3)     â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2), Subitem1(3)]  â† ãƒ¬ãƒ™ãƒ«3ä»¥ä¸Šã‚’ãƒãƒƒãƒ—
    ï¼ˆã‚¢ï¼‰(ãƒ¬ãƒ™ãƒ«4) â†’ ã‚¹ã‚¿ãƒƒã‚¯: [Paragraph(0), Item(2), Subitem1(3), Subitem2(4)]
```

---

## ğŸ”§ å®Ÿè£…æ‰‹é †

1. `hierarchy_stack`ã‚’åˆæœŸåŒ–
2. ãƒ¬ãƒ™ãƒ«2-6ã®å‡¦ç†ã§ã‚¹ã‚¿ãƒƒã‚¯ã‚’æ´»ç”¨
3. è¦ªè¦ç´ ã®æ±ºå®šã«ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½¿ç”¨
4. è¦ç´ ä½œæˆå¾Œã€ã‚¹ã‚¿ãƒƒã‚¯ã‚’æ›´æ–°

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥  
**ãƒ•ã‚¡ã‚¤ãƒ«**: `/Users/fukushima/Documents/xml_anken/gyosei-xml/scripts/education_script/reports/è¦ªã‚¿ã‚°ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã®æ”¹å–„æ¡ˆ.md`

