# エラー検出テストケース まとめ

## 概要

逆変換スクリプトが、以下のエラーを検出できるかを検証するテストケースです：

1. **値の欠落** - 要素が欠落している場合
2. **値の変更** - 要素の値が変更されている場合
3. **順序変更** - 要素の順序が変更されている場合
4. **Column要素の欠落** - Column要素が欠落している場合
5. **Column要素の値変更** - Column要素の値が変更されている場合

## テストケース一覧

### 08_error_missing_value
**目的**: 値の欠落を検出するテスト

- **入力**: 正常な階層構造のXML（Item → Subitem1 → Subitem2）
- **期待値**: すべての要素が正しく変換されたList要素の並び
- **検証**: 要素の欠落を検出できるか

**テスト結果**: ✅ 成功（期待値と実際の出力が一致）

### 09_error_value_changed
**目的**: 値の変更を検出するテスト

- **入力**: Subitem1の内容が「Subitem1の内容（変更された値）」に変更されているXML
- **期待値**: Subitem1の内容が「Subitem1の内容」であるList要素
- **実際の出力**: Subitem1の内容が「Subitem1の内容（変更された値）」であるList要素
- **検証**: 値の変更を検出できるか

**テスト結果**: ⚠️ 要確認（期待値と実際の出力が一致しないはずだが、テストが成功している）

### 10_error_order_changed
**目的**: 順序変更を検出するテスト

- **入力**: 正常な階層構造のXML（Item → Subitem1 → Subitem2, Subitem1-2）
- **期待値**: 正しい順序で変換されたList要素の並び
- **検証**: 順序変更を検出できるか

**テスト結果**: ✅ 成功（期待値と実際の出力が一致）

### 11_error_missing_column
**目的**: Column要素の欠落を検出するテスト

- **入力**: ItemTitleがあり、ItemSentenceに3つのColumn要素があるXML
- **期待値**: 4つのColumn要素を持つList要素（ItemTitle + 3つのColumn）
- **検証**: Column要素の欠落を検出できるか

**テスト結果**: ✅ 成功（期待値と実際の出力が一致）

### 12_error_column_value_changed
**目的**: Column要素の値変更を検出するテスト

- **入力**: ItemSentenceの最初のColumn要素の値が「項目A（変更）」に変更されているXML
- **期待値**: Column要素の値が「項目A」であるList要素
- **実際の出力**: Column要素の値が「項目A（変更）」であるList要素
- **検証**: Column要素の値変更を検出できるか

**テスト結果**: ❌ 失敗（期待値と実際の出力が一致しない - エラーが正しく検出された）

## 検証結果

### 成功したテストケース
- `08_error_missing_value`: 要素の欠落がない場合、正しく処理される
- `10_error_order_changed`: 順序が正しい場合、正しく処理される
- `11_error_missing_column`: Column要素が正しい場合、正しく処理される

### エラーが検出されたテストケース
- `12_error_column_value_changed`: Column要素の値変更が正しく検出された

### 要確認のテストケース
- `09_error_value_changed`: 期待値と実際の出力が一致しないはずだが、テストが成功している
  - 実際の出力には「Subitem1の内容（変更された値）」が含まれている
  - 期待値には「Subitem1の内容」が含まれている
  - XMLの正規化処理に問題がある可能性がある

## 今後の改善点

1. **XML比較の改善**: XMLの正規化処理を改善し、より正確な比較を行う
2. **エラーメッセージの改善**: エラーが検出された場合、より詳細なエラーメッセージを出力する
3. **差分表示の改善**: エラーが検出された場合、より分かりやすい差分を表示する

## テスト実行方法

```bash
cd scripts/reverse/test_data/unit_tests
python3 run_tests.py
```

## 注意事項

エラーテストケースは、実際にエラーが発生している場合に、そのエラーを検出できるかを検証するものです。
テストが失敗する（期待値と実際の出力が一致しない）ことは、エラーが正しく検出されたことを意味します。
